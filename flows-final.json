[
    {
        "id": "17245db2.768872",
        "type": "tab",
        "label": "INVENTARIO",
        "disabled": false,
        "info": ""
    },
    {
        "id": "b12df2de.6ef4d",
        "type": "tab",
        "label": "INVENTARIO_STM",
        "disabled": false,
        "info": ""
    },
    {
        "id": "c2a1f43c.ceb388",
        "type": "tab",
        "label": "INVENTARIO_STR",
        "disabled": false,
        "info": ""
    },
    {
        "id": "a9ff7244.7e88c",
        "type": "tab",
        "label": "INVENTARIO_STP",
        "disabled": false,
        "info": ""
    },
    {
        "id": "bbc414bb7e1feaec",
        "type": "serial-port",
        "serialport": "/dev/ttyUSB0",
        "serialbaud": "9600",
        "databits": "8",
        "parity": "none",
        "stopbits": "1",
        "waitfor": " ,",
        "dtr": "none",
        "rts": "none",
        "cts": "none",
        "dsr": "none",
        "newline": "1",
        "bin": "bin",
        "out": "time",
        "addchar": "",
        "responsetimeout": "10000"
    },
    {
        "id": "64e234ec8ad4b896",
        "type": "modbus-client",
        "name": "RS485-1",
        "clienttype": "simpleser",
        "bufferCommands": true,
        "stateLogEnabled": false,
        "queueLogEnabled": false,
        "tcpHost": "127.0.0.1",
        "tcpPort": "502",
        "tcpType": "DEFAULT",
        "serialPort": "/dev/ttyUSB0",
        "serialType": "RTU-BUFFERD",
        "serialBaudrate": "9600",
        "serialDatabits": "8",
        "serialStopbits": "1",
        "serialParity": "none",
        "serialConnectionDelay": "100",
        "serialAsciiResponseStartDelimiter": "0x3A",
        "unit_id": 1,
        "commandDelay": 200,
        "clientTimeout": 1000,
        "reconnectOnTimeout": true,
        "reconnectTimeout": 2000,
        "parallelUnitIdsAllowed": true
    },
    {
        "id": "cc23078f.fd1928",
        "type": "ui_group",
        "name": "ITEM CREATE",
        "tab": "fcbe2ee8.5bc8e",
        "order": 3,
        "disp": false,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "5b84c717.7cfdf8",
        "type": "ui_group",
        "name": "ITEM EDIT",
        "tab": "fcbe2ee8.5bc8e",
        "order": 4,
        "disp": false,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "3dc3a5ad.d45f1a",
        "type": "ui_group",
        "name": "ITEM DELETE",
        "tab": "fcbe2ee8.5bc8e",
        "order": 5,
        "disp": false,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "f017de5e.2fd5b",
        "type": "sqlitedb",
        "db": "/Users/mariovilar/Downloads/items-main/inventory.db",
        "mode": "RWC"
    },
    {
        "id": "ecb41ae5.77ba98",
        "type": "ui_group",
        "name": "BOTONES",
        "tab": "9288befd.7f8e4",
        "order": 1,
        "disp": false,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "3b07d5d2.35cbfa",
        "type": "ui_group",
        "name": "ITEM TABLE",
        "tab": "1bb2a854.273838",
        "order": 3,
        "disp": false,
        "width": "16",
        "collapse": false,
        "className": ""
    },
    {
        "id": "d37d52d.e17c9b",
        "type": "ui_group",
        "name": "EDIT STOCK",
        "tab": "1bb2a854.273838",
        "order": 2,
        "disp": false,
        "width": "16",
        "collapse": false,
        "className": ""
    },
    {
        "id": "55dc06a5.0069e8",
        "type": "ui_group",
        "name": "ITEM TABLE",
        "tab": "fcbe2ee8.5bc8e",
        "order": 2,
        "disp": false,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "5b1dd9dd.8b6b28",
        "type": "ui_group",
        "name": "BOTONES",
        "tab": "1bb2a854.273838",
        "order": 1,
        "disp": false,
        "width": "16",
        "collapse": false,
        "className": ""
    },
    {
        "id": "73689187.10f7a",
        "type": "ui_group",
        "name": "BOTONES",
        "tab": "fcbe2ee8.5bc8e",
        "order": 1,
        "disp": false,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "35d1d63d.95944a",
        "type": "telegram bot",
        "botname": "mariosandhar_bot",
        "usernames": "",
        "chatids": "",
        "baseapiurl": "",
        "updatemode": "polling",
        "pollinterval": "300",
        "usesocks": false,
        "sockshost": "",
        "socksport": "6667",
        "socksusername": "anonymous",
        "sockspassword": "",
        "bothost": "",
        "botpath": "",
        "localbotport": "8443",
        "publicbotport": "8443",
        "privatekey": "",
        "certificate": "",
        "useselfsignedcertificate": false,
        "sslterminated": false,
        "verboselogging": false
    },
    {
        "id": "5c4c59cc.bc44f8",
        "type": "ui_group",
        "name": "EDIT ORDER STATUS",
        "tab": "1bb2a854.273838",
        "order": 4,
        "disp": false,
        "width": "16",
        "collapse": false,
        "className": ""
    },
    {
        "id": "31e8d87b.ae0988",
        "type": "ui_group",
        "d": true,
        "name": "Group 4",
        "tab": "b5596b8f.e8a428",
        "order": 4,
        "disp": false,
        "width": "16",
        "collapse": false,
        "className": ""
    },
    {
        "id": "fcbe2ee8.5bc8e",
        "type": "ui_tab",
        "name": "INVENTARIO_DEV",
        "icon": "dashboard",
        "order": 35,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "9288befd.7f8e4",
        "type": "ui_tab",
        "name": "INVENTARIO",
        "icon": "dashboard",
        "order": 33,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "1bb2a854.273838",
        "type": "ui_tab",
        "name": "INVENTARIO_USER",
        "icon": "dashboard",
        "order": 34,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "b5596b8f.e8a428",
        "type": "ui_tab",
        "name": "INVENTARIO_STR",
        "icon": "dashboard",
        "order": 36,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "34ad96e004b17253",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#0094CE",
                    "value": "#0094CE",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#0094CE",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#fafafa",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#1bbfff",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#111111",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#0094ce",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "light"
            }
        },
        "site": {
            "name": "Node-RED Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "843b3c3a.d2369",
        "type": "ui_group",
        "name": "Group 3",
        "tab": "2b1be1be.a2a37e",
        "order": 3,
        "disp": false,
        "width": "16",
        "collapse": false,
        "className": ""
    },
    {
        "id": "953c7bf4.36a428",
        "type": "ui_group",
        "name": "Group 2",
        "tab": "2b1be1be.a2a37e",
        "order": 2,
        "disp": false,
        "width": "16",
        "collapse": false,
        "className": ""
    },
    {
        "id": "5de87a9a.808364",
        "type": "ui_group",
        "d": true,
        "name": "Group 4",
        "tab": "2b1be1be.a2a37e",
        "order": 4,
        "disp": false,
        "width": "16",
        "collapse": false,
        "className": ""
    },
    {
        "id": "ab942ba8.0ae498",
        "type": "ui_group",
        "d": true,
        "name": "Group 4",
        "tab": "598c4da3.0b6444",
        "order": 4,
        "disp": false,
        "width": "16",
        "collapse": false,
        "className": ""
    },
    {
        "id": "785b33fd.d1299c",
        "type": "ui_group",
        "name": "Group 1",
        "tab": "2b1be1be.a2a37e",
        "order": 1,
        "disp": false,
        "width": "16",
        "collapse": false,
        "className": ""
    },
    {
        "id": "2b1be1be.a2a37e",
        "type": "ui_tab",
        "name": "INVENTARIO_STM",
        "icon": "dashboard",
        "order": 37,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "598c4da3.0b6444",
        "type": "ui_tab",
        "name": "INVENTARIO_STP",
        "icon": "dashboard",
        "order": 38,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "e6361d02.78bd9",
        "type": "ui_group",
        "name": "Group 3",
        "tab": "b5596b8f.e8a428",
        "order": 3,
        "disp": false,
        "width": "16",
        "collapse": false,
        "className": ""
    },
    {
        "id": "eab13a32.b8f2a8",
        "type": "ui_group",
        "name": "Group 2",
        "tab": "b5596b8f.e8a428",
        "order": 2,
        "disp": false,
        "width": "16",
        "collapse": false,
        "className": ""
    },
    {
        "id": "8da86d5c.844a1",
        "type": "ui_group",
        "name": "Group 1",
        "tab": "b5596b8f.e8a428",
        "order": 1,
        "disp": false,
        "width": "16",
        "collapse": false,
        "className": ""
    },
    {
        "id": "eb462800.3d9528",
        "type": "ui_group",
        "name": "Group 3",
        "tab": "598c4da3.0b6444",
        "order": 3,
        "disp": false,
        "width": "16",
        "collapse": false,
        "className": ""
    },
    {
        "id": "930903de.bb3f",
        "type": "ui_group",
        "name": "Group 2",
        "tab": "598c4da3.0b6444",
        "order": 2,
        "disp": false,
        "width": "16",
        "collapse": false,
        "className": ""
    },
    {
        "id": "c2c338f.8fbb4c8",
        "type": "ui_group",
        "name": "Group 1",
        "tab": "598c4da3.0b6444",
        "order": 1,
        "disp": false,
        "width": "16",
        "collapse": false,
        "className": ""
    },
    {
        "id": "633981e5.9b32b",
        "type": "ui_button",
        "z": "17245db2.768872",
        "name": "",
        "group": "cc23078f.fd1928",
        "order": 8,
        "width": "6",
        "height": "1",
        "passthru": false,
        "label": "CREATE ITEM",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": " ",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 1060,
        "y": 320,
        "wires": [
            [
                "69699ee5.46de1",
                "70381801.420dc8"
            ]
        ]
    },
    {
        "id": "a08c9aa4.711fb8",
        "type": "ui_button",
        "z": "17245db2.768872",
        "name": "",
        "group": "5b84c717.7cfdf8",
        "order": 10,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "EDIT ITEM",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "edit",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 2050,
        "y": 320,
        "wires": [
            [
                "b0987f45.cdba",
                "2092985b.296e68"
            ]
        ]
    },
    {
        "id": "9db6083a.0ed218",
        "type": "ui_button",
        "z": "17245db2.768872",
        "name": "",
        "group": "3dc3a5ad.d45f1a",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "DELETE ITEM",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "delete",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3340,
        "y": 320,
        "wires": [
            [
                "d01115f4.8081b8",
                "a386b527.36c1d8"
            ]
        ]
    },
    {
        "id": "4fa92824.078098",
        "type": "ui_dropdown",
        "z": "17245db2.768872",
        "name": "",
        "label": "phase",
        "tooltip": "",
        "place": "Select option",
        "group": "cc23078f.fd1928",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": false,
        "multiple": false,
        "options": [
            {
                "label": "GENERAL",
                "value": "0",
                "type": "str"
            },
            {
                "label": "STATION 1",
                "value": 1,
                "type": "num"
            },
            {
                "label": "STATION 2",
                "value": 2,
                "type": "num"
            },
            {
                "label": "STATION 3",
                "value": 3,
                "type": "num"
            },
            {
                "label": "STATION 4",
                "value": 4,
                "type": "num"
            },
            {
                "label": "STATION 5",
                "value": 5,
                "type": "num"
            },
            {
                "label": "EXTRACTION",
                "value": 6,
                "type": "num"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 1270,
        "y": 560,
        "wires": [
            [
                "5af971ea.ce518"
            ]
        ]
    },
    {
        "id": "19934716.305f39",
        "type": "ui_numeric",
        "z": "17245db2.768872",
        "name": "",
        "label": "minimum stock",
        "tooltip": "",
        "group": "cc23078f.fd1928",
        "order": 6,
        "width": 0,
        "height": 0,
        "wrap": false,
        "passthru": false,
        "topic": "topic",
        "topicType": "msg",
        "format": "{{value}}",
        "min": 0,
        "max": 10,
        "step": 1,
        "className": "",
        "x": 1300,
        "y": 640,
        "wires": [
            [
                "740a3199.fb9d4"
            ]
        ]
    },
    {
        "id": "152d4897.6fa4f7",
        "type": "ui_dropdown",
        "z": "17245db2.768872",
        "name": "",
        "label": "location",
        "tooltip": "",
        "place": "Select option",
        "group": "cc23078f.fd1928",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": false,
        "multiple": true,
        "options": [
            {
                "label": "STB",
                "value": "STB",
                "type": "str"
            },
            {
                "label": "STP",
                "value": "STP",
                "type": "str"
            },
            {
                "label": "STR",
                "value": "STR",
                "type": "str"
            },
            {
                "label": "STM",
                "value": "STM",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 1282.5,
        "y": 600,
        "wires": [
            [
                "e244cfa8.ad873"
            ]
        ]
    },
    {
        "id": "4a0452ae.89b3ac",
        "type": "ui_text_input",
        "z": "17245db2.768872",
        "name": "",
        "label": "machine",
        "tooltip": "",
        "group": "cc23078f.fd1928",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": false,
        "mode": "text",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "topicType": "msg",
        "x": 1280,
        "y": 520,
        "wires": [
            [
                "1e41c977.5a0a97"
            ]
        ]
    },
    {
        "id": "912b1bfa.1970c8",
        "type": "ui_dropdown",
        "z": "17245db2.768872",
        "name": "",
        "label": "phase",
        "tooltip": "",
        "place": "Select option",
        "group": "5b84c717.7cfdf8",
        "order": 7,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "GENERAL",
                "value": "0",
                "type": "str"
            },
            {
                "label": "STATION 1",
                "value": 1,
                "type": "num"
            },
            {
                "label": "STATION 2",
                "value": 2,
                "type": "num"
            },
            {
                "label": "STATION 3",
                "value": 3,
                "type": "num"
            },
            {
                "label": "STATION 4",
                "value": 4,
                "type": "num"
            },
            {
                "label": "STATION 5",
                "value": 5,
                "type": "num"
            },
            {
                "label": "EXTRACTION",
                "value": "6",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 2290,
        "y": 540,
        "wires": [
            [
                "ca0d554.532d6a8"
            ]
        ]
    },
    {
        "id": "fcf5ab25.b5fc78",
        "type": "ui_numeric",
        "z": "17245db2.768872",
        "name": "",
        "label": "minimum stock",
        "tooltip": "",
        "group": "5b84c717.7cfdf8",
        "order": 9,
        "width": 0,
        "height": 0,
        "wrap": false,
        "passthru": true,
        "topic": "topic",
        "topicType": "msg",
        "format": "{{value}}",
        "min": 0,
        "max": 10,
        "step": 1,
        "className": "",
        "x": 2320,
        "y": 620,
        "wires": [
            [
                "dd52be4c.28c68"
            ]
        ]
    },
    {
        "id": "e0a14876.d67318",
        "type": "ui_dropdown",
        "z": "17245db2.768872",
        "name": "",
        "label": "location",
        "tooltip": "",
        "place": "Select option",
        "group": "5b84c717.7cfdf8",
        "order": 8,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": true,
        "options": [
            {
                "label": "STB",
                "value": "STB",
                "type": "str"
            },
            {
                "label": "STP",
                "value": "STP",
                "type": "str"
            },
            {
                "label": "STR",
                "value": "STR",
                "type": "str"
            },
            {
                "label": "STM",
                "value": "STM",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 2302.5,
        "y": 580,
        "wires": [
            [
                "f7f11a2d.2a7308"
            ]
        ]
    },
    {
        "id": "16488da4.b6fcc2",
        "type": "ui_text_input",
        "z": "17245db2.768872",
        "name": "",
        "label": "machine",
        "tooltip": "",
        "group": "5b84c717.7cfdf8",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "topicType": "msg",
        "x": 2300,
        "y": 500,
        "wires": [
            [
                "edc08ddd.25c0f"
            ]
        ]
    },
    {
        "id": "98d4a88c.bea038",
        "type": "ui_dropdown",
        "z": "17245db2.768872",
        "name": "",
        "label": "ITEM",
        "tooltip": "",
        "place": "Select option",
        "group": "5b84c717.7cfdf8",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 2290,
        "y": 660,
        "wires": [
            [
                "e33b9993.4d1588",
                "90777467.065fc8"
            ]
        ]
    },
    {
        "id": "7040aa40.3efbe4",
        "type": "ui_text_input",
        "z": "17245db2.768872",
        "name": "",
        "label": "name",
        "tooltip": "",
        "group": "cc23078f.fd1928",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "mode": "text",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "topicType": "msg",
        "x": 1270,
        "y": 480,
        "wires": [
            [
                "5362a203.fddbdc"
            ]
        ]
    },
    {
        "id": "10edbbf5.dad454",
        "type": "ui_text",
        "z": "17245db2.768872",
        "group": "cc23078f.fd1928",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"CREATE ITEM\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 1270,
        "y": 780,
        "wires": []
    },
    {
        "id": "eccb326d.0c429",
        "type": "ui_text",
        "z": "17245db2.768872",
        "group": "5b84c717.7cfdf8",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"EDIT ITEM\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 2290,
        "y": 800,
        "wires": []
    },
    {
        "id": "fc931a01.6f4848",
        "type": "ui_text",
        "z": "17245db2.768872",
        "group": "3dc3a5ad.d45f1a",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"DELETE ITEM\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 3090,
        "y": 500,
        "wires": []
    },
    {
        "id": "d01115f4.8081b8",
        "type": "ui_dropdown",
        "z": "17245db2.768872",
        "name": "",
        "label": "ITEM",
        "tooltip": "",
        "place": "Select option",
        "group": "3dc3a5ad.d45f1a",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 3090,
        "y": 460,
        "wires": [
            [
                "42150797.3710a8"
            ]
        ]
    },
    {
        "id": "ba6c5ba8.5b7dc8",
        "type": "inject",
        "z": "17245db2.768872",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 770,
        "y": 80,
        "wires": [
            [
                "56392632.f57348",
                "a2ec7741.bddf08",
                "67198dd5.d66a64"
            ]
        ]
    },
    {
        "id": "56392632.f57348",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "var a = flow.get(\"create_name\") != undefined;\nvar b = flow.get(\"create_machine\") != undefined;\nvar c = flow.get(\"create_phase\") != undefined;\nvar d = flow.get(\"create_location\") != undefined;\nvar e = flow.get(\"create_minstock\") != undefined;\nvar g = flow.get(\"create_reference\") != undefined;\nif(a && b && c && d && e && g) {\n    msg.enabled = true;\n} else {\n    msg.enabled = false;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 320,
        "wires": [
            [
                "633981e5.9b32b"
            ]
        ]
    },
    {
        "id": "a2ec7741.bddf08",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "var a = flow.get(\"edit_name\") != undefined;\nvar b = flow.get(\"edit_machine\") != undefined;\nvar c = flow.get(\"edit_phase\") != undefined;\nvar d = flow.get(\"edit_location\") != undefined;\nvar e = flow.get(\"edit_minstock\") != undefined;\nvar f = flow.get(\"edit_item\") != undefined;\nvar g = flow.get(\"edit_reference\") != undefined;\n\nvar array = [a,b,c,d,e,g];\n\n// s'ha editat com a mínim un paràmetre\nif(f && array.includes(true)) {\n    msg.enabled = true;\n} else {\n    msg.enabled = false;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1800,
        "y": 320,
        "wires": [
            [
                "a08c9aa4.711fb8"
            ]
        ]
    },
    {
        "id": "67198dd5.d66a64",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "var f = flow.get(\"delete_item\") != undefined;\nif(f) {\n    msg.enabled = true;\n} else {\n    msg.enabled = false;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3080,
        "y": 320,
        "wires": [
            [
                "9db6083a.0ed218"
            ]
        ]
    },
    {
        "id": "42a69889.8a22e8",
        "type": "ui_text_input",
        "z": "17245db2.768872",
        "name": "",
        "label": "name",
        "tooltip": "",
        "group": "5b84c717.7cfdf8",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "topicType": "msg",
        "x": 2290,
        "y": 460,
        "wires": [
            [
                "48cfed16.e30764"
            ]
        ]
    },
    {
        "id": "69699ee5.46de1",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "var a = flow.get(\"create_name\")\nvar b = flow.get(\"create_machine\")\nvar c = flow.get(\"create_phase\")\nvar d = flow.get(\"create_location\")\nvar e = flow.get(\"create_minstock\")\nvar g = flow.get(\"create_reference\")\n\n// mirem en quines posicions posem stock mínim\nvar all_locations = [\"STB\",\"STR\",\"STP\",\"STM\"];\nvar object = {stb: -1, str: -1, stp: -1, stm: -1}\nfor (var i = 0; i < d.length; ++i) {\n    var index = all_locations.indexOf(d[i]);\n    object[all_locations[index].toLowerCase()] = 0;\n}\n\nmsg.params = {\n    $a: a,\n    $b: b,\n    $c: c,\n    $d: d,\n    $e: e,\n    // $f: f,\n    $g: g,\n    $h: object.stb,\n    $i: object.str,\n    $j: object.stp,\n    $k: object.stm\n}\n\n// quan hem acabat desactivem el botó CREATE\nflow.set(\"create_name\",undefined)\nflow.set(\"create_machine\",undefined)\nflow.set(\"create_phase\",undefined)\nflow.set(\"create_location\",undefined)\nflow.set(\"create_minstock\",undefined)\nflow.set(\"create_reference\",undefined)\n\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1280,
        "y": 320,
        "wires": [
            [
                "8c5ef16f.99e4e"
            ]
        ]
    },
    {
        "id": "70381801.420dc8",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "return [{payload:\"\"},{payload:\"\"},{payload:null},{payload:null},{payload:0},{payload:0},{payload:\"\"}]",
        "outputs": 7,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1040,
        "y": 580,
        "wires": [
            [
                "7040aa40.3efbe4"
            ],
            [
                "4a0452ae.89b3ac"
            ],
            [
                "4fa92824.078098"
            ],
            [
                "152d4897.6fa4f7"
            ],
            [
                "19934716.305f39"
            ],
            [],
            [
                "ad32219d.6f1f2"
            ]
        ]
    },
    {
        "id": "5362a203.fddbdc",
        "type": "change",
        "z": "17245db2.768872",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "create_name",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1510,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "5af971ea.ce518",
        "type": "change",
        "z": "17245db2.768872",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "create_phase",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1510,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "e244cfa8.ad873",
        "type": "change",
        "z": "17245db2.768872",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "create_location",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1510,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "740a3199.fb9d4",
        "type": "change",
        "z": "17245db2.768872",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "create_minstock",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1510,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "a362c46a.b57ff8",
        "type": "change",
        "z": "17245db2.768872",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "create_actstock",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1510,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "2092985b.296e68",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "return [{payload:\"\"},{payload:\"\"},{payload:null},{payload:null},{payload:0},{payload:null}]",
        "outputs": 6,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2060,
        "y": 580,
        "wires": [
            [
                "42a69889.8a22e8"
            ],
            [
                "16488da4.b6fcc2",
                "ece8f95e.f8dab8"
            ],
            [
                "912b1bfa.1970c8"
            ],
            [
                "e0a14876.d67318"
            ],
            [
                "fcf5ab25.b5fc78"
            ],
            [
                "98d4a88c.bea038"
            ]
        ]
    },
    {
        "id": "b0987f45.cdba",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "var a = flow.get(\"edit_name\")\nvar b = flow.get(\"edit_machine\")\nvar c = flow.get(\"edit_phase\")\nvar d = flow.get(\"edit_location\")\nvar e = flow.get(\"edit_minstock\")\nvar f = flow.get(\"edit_item\")\nvar g = flow.get(\"edit_reference\")\n\n// mirem en quines posicions posem stock mínim\nvar all_locations = [\"STB\",\"STR\",\"STP\",\"STM\"];\nmsg.object = {stb: -1, str: -1, stp: -1, stm: -1}\nfor (var i = 0; i < d.length; ++i) {\n    var index = all_locations.indexOf(d[i]);\n    msg.object[all_locations[index].toLowerCase()] = 0;\n}\n\nvar h = msg.object.stb;\ni = msg.object.str;\nvar j = msg.object.stp;\nvar k = msg.object.stm;\n\nmsg.params = {\n    $a: a,\n    $b: b,\n    $c: c,\n    $d: d,\n    $e: e,\n    $f: f,\n    $g: g,\n    $h: h,\n    $i: i,\n    $j: j,\n    $k: k\n    \n}\n\nmsg.topic = `UPDATE low_stock SET name='${a}',location='${d}',min_stock=${e},stock_stb=${h},stock_str=${i},stock_stp=${j},stock_stm=${k} WHERE item_id=${f}`;\n\n// quan hem acabat desactivem el botó EDIT\nflow.set(\"edit_name\",undefined)\nflow.set(\"edit_machine\",undefined)\nflow.set(\"edit_phase\",undefined)\nflow.set(\"edit_location\",undefined)\nflow.set(\"edit_minstock\",undefined)\nflow.set(\"edit_item\",undefined)\nflow.set(\"edit_reference\",undefined)\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2300,
        "y": 320,
        "wires": [
            [
                "fa26f0a7.3e08b",
                "5d4cc5b9.b0c27c"
            ]
        ]
    },
    {
        "id": "48cfed16.e30764",
        "type": "change",
        "z": "17245db2.768872",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "edit_name",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2570,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "edc08ddd.25c0f",
        "type": "change",
        "z": "17245db2.768872",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "edit_machine",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2570,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "ca0d554.532d6a8",
        "type": "change",
        "z": "17245db2.768872",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "edit_phase",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2570,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "f7f11a2d.2a7308",
        "type": "change",
        "z": "17245db2.768872",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "edit_location",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2570,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "dd52be4c.28c68",
        "type": "change",
        "z": "17245db2.768872",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "edit_minstock",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2570,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "e33b9993.4d1588",
        "type": "change",
        "z": "17245db2.768872",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "edit_item",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2570,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "8c5ef16f.99e4e",
        "type": "sqlite",
        "z": "17245db2.768872",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "prepared",
        "sql": "INSERT INTO `items`(`name`,`maq`,`phase`,`location`,`reference`,`min_stock`,`stock_stb`,`stock_str`,`stock_stp`,`stock_stm`) VALUES($a,$b,$c,$d,$g,$e,$h,$i,$j,$k)",
        "name": "INVENTORY",
        "x": 1290,
        "y": 400,
        "wires": [
            [
                "271ce25a.498f0e"
            ]
        ]
    },
    {
        "id": "42150797.3710a8",
        "type": "change",
        "z": "17245db2.768872",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "delete_item",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3310,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "a386b527.36c1d8",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "var f = flow.get(\"delete_item\")\nmsg.params = {\n    $a: f\n}\n// quan hem acabat desactivem el botó DELETE\nflow.set(\"delete_item\",undefined)\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3600,
        "y": 320,
        "wires": [
            [
                "182dc4ae.c065bb",
                "b77d974.1ccc668"
            ]
        ]
    },
    {
        "id": "fa26f0a7.3e08b",
        "type": "sqlite",
        "z": "17245db2.768872",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "prepared",
        "sql": "UPDATE `items` SET `name`=$a,`maq`=$b,`phase`=$c,`location`=$d,`reference`=$g,`min_stock`=$e,`stock_stb`=$h,`stock_str`=$i,`stock_stp`=$j,`stock_stm`=$k WHERE `id`=$f",
        "name": "INVENTORY",
        "x": 2310,
        "y": 400,
        "wires": [
            [
                "987a75eb.5344e8"
            ]
        ]
    },
    {
        "id": "504d3b3b.604154",
        "type": "link in",
        "z": "17245db2.768872",
        "name": "",
        "links": [
            "7164db68.d90444"
        ],
        "x": 2115,
        "y": 660,
        "wires": [
            [
                "98d4a88c.bea038"
            ]
        ]
    },
    {
        "id": "7164db68.d90444",
        "type": "link out",
        "z": "17245db2.768872",
        "name": "item",
        "mode": "link",
        "links": [
            "54f533e7.a3178c",
            "4dbb1efb.ae816",
            "504d3b3b.604154"
        ],
        "x": 845,
        "y": 520,
        "wires": []
    },
    {
        "id": "4dbb1efb.ae816",
        "type": "link in",
        "z": "17245db2.768872",
        "name": "",
        "links": [
            "7164db68.d90444"
        ],
        "x": 2895,
        "y": 460,
        "wires": [
            [
                "d01115f4.8081b8"
            ]
        ]
    },
    {
        "id": "df975d9ca1ce1bd7",
        "type": "ui_button",
        "z": "17245db2.768872",
        "name": "",
        "group": "ecb41ae5.77ba98",
        "order": 3,
        "width": "6",
        "height": "1",
        "passthru": false,
        "label": "EDITOR VIEW",
        "tooltip": "",
        "color": "white",
        "bgcolor": "black",
        "className": "",
        "icon": "battery_charging_90",
        "payload": "{\"tab\":\"INVENTARIO_DEV\"}",
        "payloadType": "json",
        "topic": "",
        "topicType": "str",
        "x": 340,
        "y": 200,
        "wires": [
            [
                "47ce3acc.f06564"
            ]
        ]
    },
    {
        "id": "2e2a64d61894b172",
        "type": "ui_button",
        "z": "17245db2.768872",
        "name": "",
        "group": "ecb41ae5.77ba98",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "USER VIEW",
        "tooltip": "",
        "color": "white",
        "bgcolor": "black",
        "className": "",
        "icon": "battery_charging_50",
        "payload": "{\"tab\":\"INVENTARIO_USER\"}",
        "payloadType": "json",
        "topic": "",
        "topicType": "str",
        "x": 350,
        "y": 160,
        "wires": [
            [
                "47ce3acc.f06564"
            ]
        ]
    },
    {
        "id": "50fa41597bb0b193",
        "type": "ui_text",
        "z": "17245db2.768872",
        "group": "ecb41ae5.77ba98",
        "order": 1,
        "width": "6",
        "height": "3",
        "name": "QUÉ VISTA",
        "label": "",
        "format": "QUÉ VISTA QUIERES VER",
        "layout": "row-center",
        "className": "",
        "x": 350,
        "y": 120,
        "wires": []
    },
    {
        "id": "271ce25a.498f0e",
        "type": "link out",
        "z": "17245db2.768872",
        "name": "create",
        "links": [
            "3b237080.2e498",
            "530feabf.fbd634",
            "c5446df4.5f362",
            "f0947a70428a3e08"
        ],
        "x": 1535,
        "y": 400,
        "wires": []
    },
    {
        "id": "52ff29c1.1ac1e8",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "let array = [];\nfor(let i = 0; i < msg.payload.length; ++i) {\n    let id = msg.payload[i].id;\n    let name = msg.payload[i].name;\n    array.push(JSON.parse(`{\"${name}\":${id}}`));\n}\nmsg.options = array;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 520,
        "wires": [
            [
                "7164db68.d90444"
            ]
        ]
    },
    {
        "id": "182dc4ae.c065bb",
        "type": "sqlite",
        "z": "17245db2.768872",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "prepared",
        "sql": "DELETE FROM `items` WHERE `id`=$a",
        "name": "INVENTORY",
        "x": 3610,
        "y": 420,
        "wires": [
            [
                "5f1c9a49.6cf0d4"
            ]
        ]
    },
    {
        "id": "db72f4cf.30dd18",
        "type": "ui_table",
        "z": "17245db2.768872",
        "group": "3b07d5d2.35cbfa",
        "name": "ITEMTABLE TOTAL",
        "order": 2,
        "width": "16",
        "height": "3",
        "columns": [
            {
                "field": "name",
                "title": "NAME",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "location",
                "title": "LOC",
                "width": "10%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "maq",
                "title": "MAQ",
                "width": "10%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "reference",
                "title": "REFERENCE",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "phase",
                "title": "PHASE",
                "width": "15%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "min_stock",
                "title": "MIN-STOCK",
                "width": "15%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "stock_stb",
                "title": "STOCK-STB",
                "width": "15%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "stock_str",
                "title": "STOCK-STR",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "stock_stp",
                "title": "STOCK-STP",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "stock_stm",
                "title": "STOCK-STM",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 750,
        "y": 420,
        "wires": []
    },
    {
        "id": "ed2af026.faeb8",
        "type": "sqlite",
        "z": "17245db2.768872",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "fixed",
        "sql": "SELECT * FROM `items`;",
        "name": "INVENTORY",
        "x": 430,
        "y": 460,
        "wires": [
            [
                "db72f4cf.30dd18",
                "5416ce2e.ca992"
            ]
        ]
    },
    {
        "id": "530feabf.fbd634",
        "type": "link in",
        "z": "17245db2.768872",
        "name": "",
        "links": [
            "271ce25a.498f0e",
            "5f1c9a49.6cf0d4",
            "76e1504d.e96b8",
            "792f9a1a.4ad0d4",
            "987a75eb.5344e8",
            "b42dce68.da7db",
            "dd46fcbf.71e3f"
        ],
        "x": 215,
        "y": 520,
        "wires": [
            [
                "9cfd4fef61e092ed"
            ]
        ]
    },
    {
        "id": "987a75eb.5344e8",
        "type": "link out",
        "z": "17245db2.768872",
        "name": "edit",
        "links": [
            "530feabf.fbd634",
            "c5446df4.5f362",
            "f0947a70428a3e08"
        ],
        "x": 2535,
        "y": 400,
        "wires": []
    },
    {
        "id": "5f1c9a49.6cf0d4",
        "type": "link out",
        "z": "17245db2.768872",
        "name": "delete",
        "links": [
            "530feabf.fbd634",
            "11001bb0.838e04"
        ],
        "x": 3755,
        "y": 420,
        "wires": []
    },
    {
        "id": "f1b354b6.074648",
        "type": "comment",
        "z": "17245db2.768872",
        "name": "LIST ELEMENTS IN EDITOR",
        "info": "",
        "x": 480,
        "y": 580,
        "wires": []
    },
    {
        "id": "11bf1830.ef3518",
        "type": "comment",
        "z": "17245db2.768872",
        "name": "TABLE SELECT",
        "info": "",
        "x": 440,
        "y": 400,
        "wires": []
    },
    {
        "id": "7569a2b9.0c443c",
        "type": "ui_dropdown",
        "z": "17245db2.768872",
        "name": "",
        "label": "item",
        "tooltip": "",
        "place": "Select option",
        "group": "d37d52d.e17c9b",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": false,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 430,
        "y": 1020,
        "wires": [
            [
                "1deb4413.236c7c"
            ]
        ]
    },
    {
        "id": "a517f3a0.b66d8",
        "type": "ui_button",
        "z": "17245db2.768872",
        "name": "",
        "group": "d37d52d.e17c9b",
        "order": 6,
        "width": "16",
        "height": "1",
        "passthru": false,
        "label": "EDIT STOCK",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": " ",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 460,
        "y": 820,
        "wires": [
            [
                "ed537020.d1f71",
                "2b63cb9e.218ad4"
            ]
        ]
    },
    {
        "id": "cd5045bd.be2638",
        "type": "sqlite",
        "z": "17245db2.768872",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "msg.topic",
        "sql": "-- UPDATE `items` SET `stock_actual`=((SELECT `stock_actual` FROM `items` WHERE `id`=$a)+$b) WHERE `id`=$a;\nUPDATE `items` SET `stock_actual`=(`stock_actual`+$b) WHERE `id`=$a;",
        "name": "INVENTORY",
        "x": 710,
        "y": 880,
        "wires": [
            [
                "320c5756.dd78c8"
            ]
        ]
    },
    {
        "id": "1deb4413.236c7c",
        "type": "change",
        "z": "17245db2.768872",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "user_item",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 650,
        "y": 1020,
        "wires": [
            []
        ]
    },
    {
        "id": "59f56ea3.e60ce",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "var a = flow.get(\"user_item\") != undefined;\nvar b = flow.get(\"user_stock\") != undefined;\nvar c = flow.get(\"user_stock\") != 0;\nvar d = flow.get(\"user_location\") != undefined;\n\nif(a && b && c && d) {\n    msg.enabled = true;\n} else {\n    msg.enabled = false;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 820,
        "wires": [
            [
                "a517f3a0.b66d8"
            ]
        ]
    },
    {
        "id": "69b7dc5a.a302a4",
        "type": "inject",
        "z": "17245db2.768872",
        "name": "1'",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 450,
        "y": 740,
        "wires": [
            [
                "59f56ea3.e60ce"
            ]
        ]
    },
    {
        "id": "59a7e696.c5c4d8",
        "type": "ui_slider",
        "z": "17245db2.768872",
        "name": "STOCK USED",
        "label": "STOCK VARIATION",
        "tooltip": "",
        "group": "d37d52d.e17c9b",
        "order": 2,
        "width": "14",
        "height": "1",
        "passthru": false,
        "outs": "all",
        "topic": "topic",
        "topicType": "msg",
        "min": "-10",
        "max": 10,
        "step": 1,
        "className": "",
        "x": 460,
        "y": 980,
        "wires": [
            [
                "35236fdc.6b2de",
                "97dfafd8.93074"
            ]
        ]
    },
    {
        "id": "ed537020.d1f71",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "return [{payload: null},{payload: 0}];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 900,
        "wires": [
            [
                "7569a2b9.0c443c",
                "8a97b86a.8666b8"
            ],
            [
                "59a7e696.c5c4d8",
                "97dfafd8.93074"
            ]
        ]
    },
    {
        "id": "b42dce68.da7db",
        "type": "link out",
        "z": "17245db2.768872",
        "name": "user",
        "mode": "link",
        "links": [
            "530feabf.fbd634",
            "c5446df4.5f362",
            "f0947a70428a3e08",
            "1c6eed0e.e48003",
            "3ecc57b7.5ba128",
            "bc7560d7.53ee2",
            "f175c7e8.f86d18"
        ],
        "x": 1075,
        "y": 880,
        "wires": []
    },
    {
        "id": "5416ce2e.ca992",
        "type": "ui_table",
        "z": "17245db2.768872",
        "group": "55dc06a5.0069e8",
        "name": "ITEMTABLE",
        "order": 0,
        "width": "6",
        "height": "3",
        "columns": [
            {
                "field": "name",
                "title": "NAME",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "location",
                "title": "LOC",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "maq",
                "title": "MAQ",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "phase",
                "title": "PHA",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "min_stock",
                "title": "MIN",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 730,
        "y": 460,
        "wires": []
    },
    {
        "id": "35236fdc.6b2de",
        "type": "change",
        "z": "17245db2.768872",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "user_stock",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 650,
        "y": 980,
        "wires": [
            []
        ]
    },
    {
        "id": "cac4d379.929e4",
        "type": "ui_text",
        "z": "17245db2.768872",
        "group": "d37d52d.e17c9b",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"EDIT STOCK ACTUAL\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 670,
        "y": 740,
        "wires": []
    },
    {
        "id": "97dfafd8.93074",
        "type": "ui_text",
        "z": "17245db2.768872",
        "group": "d37d52d.e17c9b",
        "order": 3,
        "width": "2",
        "height": "1",
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC> {{msg.payload}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 950,
        "y": 980,
        "wires": []
    },
    {
        "id": "f3ba65ee.577b38",
        "type": "ui_button",
        "z": "17245db2.768872",
        "name": "",
        "group": "5b1dd9dd.8b6b28",
        "order": 2,
        "width": "8",
        "height": "1",
        "passthru": false,
        "label": "EDITOR VIEW",
        "tooltip": "",
        "color": "white",
        "bgcolor": "black",
        "className": "",
        "icon": "battery_charging_90",
        "payload": "{\"tab\":\"+1\"}",
        "payloadType": "json",
        "topic": "",
        "topicType": "str",
        "x": 460,
        "y": 660,
        "wires": [
            [
                "56690fa9.009b9"
            ]
        ]
    },
    {
        "id": "e667da31.3e91f8",
        "type": "ui_button",
        "z": "17245db2.768872",
        "name": "",
        "group": "73689187.10f7a",
        "order": 3,
        "width": "3",
        "height": "1",
        "passthru": false,
        "label": "USER VIEW",
        "tooltip": "",
        "color": "white",
        "bgcolor": "black",
        "className": "",
        "icon": "battery_charging_50",
        "payload": "{\"tab\":\"-1\"}",
        "payloadType": "json",
        "topic": "",
        "topicType": "str",
        "x": 1730,
        "y": 600,
        "wires": [
            [
                "b46e6f4b.de376"
            ]
        ]
    },
    {
        "id": "47ce3acc.f06564",
        "type": "ui_ui_control",
        "z": "17245db2.768872",
        "name": "",
        "events": "all",
        "x": 560,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "56690fa9.009b9",
        "type": "ui_ui_control",
        "z": "17245db2.768872",
        "name": "",
        "events": "all",
        "x": 680,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "b46e6f4b.de376",
        "type": "ui_ui_control",
        "z": "17245db2.768872",
        "name": "",
        "events": "all",
        "x": 1740,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "f5c79cf4.5076c",
        "type": "sqlite",
        "z": "17245db2.768872",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "prepared",
        "sql": "SELECT * FROM `items` WHERE `id`=$a;",
        "name": "INVENTORY",
        "x": 2750,
        "y": 660,
        "wires": [
            [
                "ef17fc59.2a15c",
                "4e96c3cd6b7c4974"
            ]
        ]
    },
    {
        "id": "ef17fc59.2a15c",
        "type": "link out",
        "z": "17245db2.768872",
        "name": "query",
        "mode": "link",
        "links": [
            "99c3af62.d9c41"
        ],
        "x": 2695,
        "y": 600,
        "wires": []
    },
    {
        "id": "ff5981b.a8ef88",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "/*\nvar array = []\narray.push(JSON.parse(`{\"payload\": \"${msg.payload[0].name}\"}`))\narray.push(JSON.parse(`{\"payload\": \"${msg.payload[0].maq}\"}`))\narray.push(JSON.parse(`{\"payload\": ${msg.payload[0].phase}}`))\narray.push(JSON.parse(`{\"payload\": \"${msg.payload[0].location}\"}`))\narray.push(JSON.parse(`{\"payload\": ${msg.payload[0].min_stock}}`));\n*/\n\nvar result = [msg.payload[0].name,msg.payload[0].maq,msg.payload[0].phase,msg.payload[0].location,msg.payload[0].min_stock,msg.payload[0].reference]\nvar array = []\nconst ATR_LENGTH = 6;\n\n// pot estar a múltiples localitzacions\nvar locats = result[3].split(\",\");\nmsg.locats = locats;\n\nfor(var i = 0; i < ATR_LENGTH; ++i) {\n    if(i == 2 || i == 4) {\n        array.push(JSON.parse(`{\"payload\":${result[i]}}`));\n    } else if (i == 3) {\n        array.push(JSON.parse(`{\"payload\":\"${locats}\"}`));\n    } \n    else {\n        array.push(JSON.parse(`{\"payload\":\"${result[i]}\"}`));\n    }\n}\n\n\nreturn array;",
        "outputs": 6,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2060,
        "y": 460,
        "wires": [
            [
                "42a69889.8a22e8"
            ],
            [
                "16488da4.b6fcc2"
            ],
            [
                "912b1bfa.1970c8"
            ],
            [
                "e0a14876.d67318"
            ],
            [
                "fcf5ab25.b5fc78"
            ],
            [
                "ece8f95e.f8dab8"
            ]
        ]
    },
    {
        "id": "99c3af62.d9c41",
        "type": "link in",
        "z": "17245db2.768872",
        "name": "",
        "links": [
            "ef17fc59.2a15c"
        ],
        "x": 1905,
        "y": 460,
        "wires": [
            [
                "ff5981b.a8ef88"
            ]
        ]
    },
    {
        "id": "90777467.065fc8",
        "type": "function",
        "z": "17245db2.768872",
        "name": "SET",
        "func": "msg.params = {\n    $a: msg.payload\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2570,
        "y": 700,
        "wires": [
            [
                "f5c79cf4.5076c"
            ]
        ],
        "icon": "node-red/swap.svg"
    },
    {
        "id": "6f413445.c0c57c",
        "type": "comment",
        "z": "17245db2.768872",
        "name": "es podria intentar no fer una query extra treballant amb stock actual i el min-stock, per no haver de comprovar tots els ítems",
        "info": "",
        "x": 630,
        "y": 1260,
        "wires": []
    },
    {
        "id": "5fc7f63d.50d8b8",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "var low_stock = false;\nfor(var i = 0; i < msg.payload.length; ++i) {\n    if(!msg.low.includes(msg.payload[i].id)) {\n        msg.topic = `INSERT INTO low_stock(item_id,name,location,min_stock,stock_stb,stock_str,stock_stp,stock_stm,ordered) VALUES(${msg.payload[i].id},'${msg.payload[i].name}','${msg.payload[i].location}',${msg.payload[i].min_stock},${msg.payload[i].stock_stb},${msg.payload[i].stock_str},${msg.payload[i].stock_stp},${msg.payload[i].stock_stm},0)`;\n        node.send(msg);\n    }\n}\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 180,
        "y": 1420,
        "wires": [
            [
                "7a98bd1.392f744"
            ]
        ]
    },
    {
        "id": "c47370cb.9e01f",
        "type": "sqlite",
        "z": "17245db2.768872",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "fixed",
        "sql": "SELECT `item_id` FROM `low_stock`;",
        "name": "INVENTORY",
        "x": 470,
        "y": 1320,
        "wires": [
            [
                "2c1e9783.79c728"
            ]
        ]
    },
    {
        "id": "2c1e9783.79c728",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "// si ens interessés agafar més que l'id podríem canviar el zero\n// per una j i iterar pel nombre de propietats que volguéssim agafar\n\nvar array = []\nfor(var i = 0; i < msg.payload.length; ++i) {\n    array.push(Object.values(msg.payload[i])[0])\n}\nmsg.low = array\n/*\nmsg.topic = `SELECT id,name,location,min_stock,stock_stb,stock_stp,stock_str,stock_stm FROM items`\nmsg.topic += `WHERE (min_stock>=stock_stb AND stock_stb>=0) OR `;\nmsg.topic += `(min_stock>=stock_str AND stock_str>=0) OR `;\nmsg.topic += `(min_stock>=stock_stp AND stock_stp>=0) OR `;\nmsg.topic += `(min_stock>=stock_stm AND stock_stm>=0)`;\n*/\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 1320,
        "wires": [
            [
                "90d5a54.ece2f58"
            ]
        ]
    },
    {
        "id": "90d5a54.ece2f58",
        "type": "sqlite",
        "z": "17245db2.768872",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "fixed",
        "sql": "SELECT * FROM `items` WHERE (`min_stock`>=`stock_stb` AND `stock_stb`>=0) OR (`min_stock`>=`stock_stm` AND `stock_stm`>=0) OR  (`min_stock`>=`stock_str` AND `stock_str`>=0) OR (`min_stock`>=`stock_stp` AND `stock_stp`>=0)",
        "name": "INVENTORY",
        "x": 970,
        "y": 1320,
        "wires": [
            [
                "5fc7f63d.50d8b8"
            ]
        ]
    },
    {
        "id": "ec37d86b.ba5598",
        "type": "sqlite",
        "z": "17245db2.768872",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "fixed",
        "sql": "SELECT * FROM `low_stock`;",
        "name": "INVENTORY",
        "x": 710,
        "y": 1500,
        "wires": [
            [
                "b02754d.f4413a8",
                "792f9a1a.4ad0d4"
            ]
        ]
    },
    {
        "id": "82de843.a760f78",
        "type": "comment",
        "z": "17245db2.768872",
        "name": "COMPROVEM MINSTOCK VS ACTUAL_STOCK",
        "info": "",
        "x": 400,
        "y": 1200,
        "wires": []
    },
    {
        "id": "7a98bd1.392f744",
        "type": "sqlite",
        "z": "17245db2.768872",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "msg.topic",
        "sql": "SELECT * FROM `low_stock` WHERE `ordered`=0;",
        "name": "INVENTORY",
        "x": 470,
        "y": 1420,
        "wires": [
            []
        ]
    },
    {
        "id": "85112eae.7f302",
        "type": "ui_table",
        "z": "17245db2.768872",
        "group": "3b07d5d2.35cbfa",
        "name": "ITEMTABLE NOORDERED",
        "order": 4,
        "width": "16",
        "height": "3",
        "columns": [
            {
                "field": "name",
                "title": "NAME",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "min_stock",
                "title": "MIN",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "stock_stb",
                "title": "STB NOW",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "stock_str",
                "title": "STR NOW",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "stock_stp",
                "title": "STP NOW",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "stock_stm",
                "title": "STM NOW",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 760,
        "y": 1420,
        "wires": []
    },
    {
        "id": "ce3e4ef5.b3bf2",
        "type": "delay",
        "z": "17245db2.768872",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 460,
        "y": 1500,
        "wires": [
            [
                "ec37d86b.ba5598"
            ]
        ]
    },
    {
        "id": "c32f741c.2d21e8",
        "type": "telegram receiver",
        "z": "17245db2.768872",
        "d": true,
        "name": "EVENT LISTENER",
        "bot": "35d1d63d.95944a",
        "saveDataDir": "",
        "filterCommands": false,
        "x": 1530,
        "y": 2020,
        "wires": [
            [
                "5c728a41.42f554"
            ],
            [
                "5c728a41.42f554"
            ]
        ]
    },
    {
        "id": "5c728a41.42f554",
        "type": "function",
        "z": "17245db2.768872",
        "d": true,
        "name": "",
        "func": "var possibles_respostes = [\"Y\",\"YES\",\"yes\",\"ye\",\"y\",\"s\",\"si\",\"sí\",\"N\",\"n\",\"NO\",\"no\"];\nif(!possibles_respostes.includes(msg.payload.content)) {\n   return [{payload:{\n       content: \"PLEASE TRY AGAIN. BAD INPUT\",\n       type: \"message\",\n       chatId: \"5019177108\"\n   }},null] \n} else {\n    if(possibles_respostes.slice(0,8).includes(msg.payload.content)) {\n        \n    } else if(possibles_respostes.slice(8).includes(msg.payload.content)) {\n        \n    } else {\n        return [{payload:{\n            content: \"PLEASE TRY AGAIN. UNKNOWN ERROR\",\n            type: \"message\",\n            chatId: \"5019177108\"\n        }},null] \n    }\n}\n\nreturn null;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1560,
        "y": 1960,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "4b55a00c.933f6",
        "type": "ui_text",
        "z": "17245db2.768872",
        "group": "3b07d5d2.35cbfa",
        "order": 5,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"NEED RESTOCK AND HAS BEEN ORDERED\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 1570,
        "y": 2140,
        "wires": []
    },
    {
        "id": "80d0db66.4ca248",
        "type": "ui_text",
        "z": "17245db2.768872",
        "group": "3b07d5d2.35cbfa",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"LIST OF ALL ITEMS\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 250,
        "y": 400,
        "wires": []
    },
    {
        "id": "9bee4e33.42bb4",
        "type": "ui_text",
        "z": "17245db2.768872",
        "group": "3b07d5d2.35cbfa",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"NEED RESTOCK NO ORDERED\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 1570,
        "y": 2220,
        "wires": []
    },
    {
        "id": "46f6dd72.4f7dc4",
        "type": "ui_table",
        "z": "17245db2.768872",
        "group": "3b07d5d2.35cbfa",
        "name": "ITEMTABLE ORDERED",
        "order": 6,
        "width": "16",
        "height": "3",
        "columns": [
            {
                "field": "name",
                "title": "NAME",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "min_stock",
                "title": "MIN",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "stock_stb",
                "title": "STB NOW",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "stock_str",
                "title": "STR NOW",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "stock_stp",
                "title": "STP NOW",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "stock_stm",
                "title": "STM NOW",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 1070,
        "y": 1420,
        "wires": []
    },
    {
        "id": "3fe9d737.d1ef18",
        "type": "ui_dropdown",
        "z": "17245db2.768872",
        "name": "",
        "label": "ITEM",
        "tooltip": "",
        "place": "Select option",
        "group": "5c4c59cc.bc44f8",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 450,
        "y": 1700,
        "wires": [
            [
                "3120f2b0.208d4e",
                "5b6fec072365d05f",
                "a76aca0cb6b64a9f"
            ]
        ]
    },
    {
        "id": "78056e32.c7d18",
        "type": "ui_button",
        "z": "17245db2.768872",
        "name": "",
        "group": "5c4c59cc.bc44f8",
        "order": 3,
        "width": "16",
        "height": "1",
        "passthru": false,
        "label": "EDIT ORDER STATUS",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": " ",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 500,
        "y": 1820,
        "wires": [
            [
                "92f276f0.4b00d8",
                "7c61066e.ea0a48"
            ]
        ]
    },
    {
        "id": "e4933c4e.65873",
        "type": "ui_text",
        "z": "17245db2.768872",
        "group": "31e8d87b.ae0988",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "ORDER STATUS",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"ORDER ITEM\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 1540,
        "y": 2180,
        "wires": []
    },
    {
        "id": "a8eda3b0.591aa",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "let array = [];\nfor(let i = 0; i < msg.payload.length; ++i) {\n    let id = msg.payload[i].id;\n    let name = msg.payload[i].name;\n    array.push(JSON.parse(`{\"${name}\":${id}}`));\n}\nmsg.options = array;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 940,
        "y": 1580,
        "wires": [
            [
                "3fe9d737.d1ef18"
            ]
        ]
    },
    {
        "id": "c2a328d7.de4258",
        "type": "sqlite",
        "z": "17245db2.768872",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "prepared",
        "sql": "-- UPDATE `items` SET `stock_actual`=((SELECT `stock_actual` FROM `items` WHERE `id`=$a)+$b) WHERE `id`=$a;\nUPDATE `low_stock` SET `ordered`=1 WHERE `id`=$a;",
        "name": "INVENTORY",
        "x": 810,
        "y": 1820,
        "wires": [
            [
                "ef48c167.f6c1d"
            ]
        ]
    },
    {
        "id": "76e1504d.e96b8",
        "type": "link out",
        "z": "17245db2.768872",
        "name": "ordered",
        "links": [
            "76f84a6d.f5a524",
            "530feabf.fbd634",
            "f0947a70428a3e08",
            "3ecc57b7.5ba128",
            "bc7560d7.53ee2",
            "f175c7e8.f86d18"
        ],
        "x": 1135,
        "y": 1820,
        "wires": []
    },
    {
        "id": "92f276f0.4b00d8",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "var a = flow.get(\"order_item\");\n\nmsg.params = {\n    $a: a\n}\n\n// quan hem acabat desactivem el botó CREATE\nflow.set(\"order_item\",undefined);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 1760,
        "wires": [
            [
                "c2a328d7.de4258"
            ]
        ]
    },
    {
        "id": "7c61066e.ea0a48",
        "type": "function",
        "z": "17245db2.768872",
        "name": "SET",
        "func": "msg.payload = null;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 1760,
        "wires": [
            [
                "3fe9d737.d1ef18"
            ]
        ],
        "icon": "node-red/swap.svg"
    },
    {
        "id": "9162f5dc.7aa818",
        "type": "inject",
        "z": "17245db2.768872",
        "name": "1s",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 250,
        "y": 1920,
        "wires": [
            [
                "90c438ba.92c768"
            ]
        ]
    },
    {
        "id": "90c438ba.92c768",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "if(flow.get(\"order_item\") != undefined) {\n    msg.enabled = true;\n} else {\n    msg.enabled = false;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 1920,
        "wires": [
            [
                "78056e32.c7d18"
            ]
        ]
    },
    {
        "id": "3120f2b0.208d4e",
        "type": "change",
        "z": "17245db2.768872",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "order_item",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 790,
        "y": 1700,
        "wires": [
            []
        ]
    },
    {
        "id": "c5446df4.5f362",
        "type": "link in",
        "z": "17245db2.768872",
        "name": "",
        "links": [
            "271ce25a.498f0e",
            "4cf35f5b.b7911",
            "987a75eb.5344e8",
            "b42dce68.da7db",
            "d37fda0b.b354d8",
            "ef26292d.c7b308"
        ],
        "x": 275,
        "y": 1420,
        "wires": [
            [
                "c47370cb.9e01f"
            ]
        ]
    },
    {
        "id": "ef48c167.f6c1d",
        "type": "delay",
        "z": "17245db2.768872",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 1000,
        "y": 1820,
        "wires": [
            [
                "76e1504d.e96b8"
            ]
        ]
    },
    {
        "id": "5d4cc5b9.b0c27c",
        "type": "sqlite",
        "z": "17245db2.768872",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "msg.topic",
        "sql": "UPDATE `low_stock` SET `name`=$a, `min_stock`=$e WHERE `item_id`=$f",
        "name": "INVENTORY",
        "x": 2590,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "b77d974.1ccc668",
        "type": "sqlite",
        "z": "17245db2.768872",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "prepared",
        "sql": "DELETE FROM `low_stock` WHERE `item_id`=$a",
        "name": "INVENTORY",
        "x": 3870,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "11001bb0.838e04",
        "type": "link in",
        "z": "17245db2.768872",
        "name": "",
        "links": [
            "5f1c9a49.6cf0d4",
            "792f9a1a.4ad0d4"
        ],
        "x": 255,
        "y": 2300,
        "wires": [
            [
                "f9efc2c6.8eb75"
            ]
        ]
    },
    {
        "id": "8befa733.66b0d8",
        "type": "comment",
        "z": "17245db2.768872",
        "name": "MIRAREM QUE NO PUGUEM TREURE ALGUN DELS VALORS DE LA LLISTA DE LOW_STOCK (aprofitant queries ja fetes)",
        "info": "",
        "x": 600,
        "y": 2220,
        "wires": []
    },
    {
        "id": "e977322f.2b095",
        "type": "sqlite",
        "z": "17245db2.768872",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "fixed",
        "sql": "SELECT * FROM `low_stock` WHERE `ordered`=0;",
        "name": "INVENTORY",
        "x": 810,
        "y": 1980,
        "wires": [
            [
                "4a7c3a76.130844"
            ]
        ]
    },
    {
        "id": "4a7c3a76.130844",
        "type": "function",
        "z": "17245db2.768872",
        "name": "SET",
        "func": "// si el missatge no conté res, no fem res\nif(msg.payload.length === 0) {\n    return msg;\n}\n\nvar string = \"\" // localitzacions que necessiten restock\nvar locations = [\"STB\",\"STR\",\"STP\",\"STM\"]\nfor (var i = 0; i < msg.payload.length; ++i) {\n    var attributes = Object.values(msg.payload[i]);\n    for (var j = 5; j < attributes.length - 1; ++j) {\n        if (attributes[4] >= attributes[j] && attributes[j] >= 0) {\n            var calcul = attributes[4] - attributes[j];\n            string += `${calcul} unit/s of item \"${msg.payload[i].name}\" from plant \"${locations[j-5]}\" are needed to cover minimum stock. `;\n        }\n    }\n}\n\nstring += \"PLEASE, PLACE AN ORDER AT YOUR EARLIEST CONVINIENCE.\"; // addició final\n\nmsg.payload = {\n    content: string,\n    type: \"message\",\n    chatId: \"5019177108\"\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1010,
        "y": 1980,
        "wires": [
            [
                "fea2225a.f864e",
                "db0618a32574a28a"
            ]
        ],
        "icon": "node-red/swap.svg"
    },
    {
        "id": "1ed4c692.39daf9",
        "type": "inject",
        "z": "17245db2.768872",
        "name": "1D",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "00 08 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 470,
        "y": 1980,
        "wires": [
            [
                "e977322f.2b095"
            ]
        ]
    },
    {
        "id": "b02754d.f4413a8",
        "type": "function",
        "z": "17245db2.768872",
        "name": "SET msg.payload",
        "func": "var array_order = [];\nvar array_noorder = [];\n\nfor(var i = 0; i < msg.payload.length; ++i) {\n    if(msg.payload[i].ordered === 0) {\n        array_noorder.push(msg.payload[i])\n    } else {\n        array_order.push(msg.payload[i])\n    }\n}\nreturn [{payload: array_noorder},{payload: array_order}];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 1500,
        "wires": [
            [
                "85112eae.7f302",
                "a8eda3b0.591aa"
            ],
            [
                "46f6dd72.4f7dc4"
            ]
        ],
        "icon": "node-red/swap.svg"
    },
    {
        "id": "792f9a1a.4ad0d4",
        "type": "link out",
        "z": "17245db2.768872",
        "name": "low_stock",
        "mode": "link",
        "links": [
            "11001bb0.838e04",
            "530feabf.fbd634",
            "3ecc57b7.5ba128",
            "bc7560d7.53ee2",
            "f175c7e8.f86d18"
        ],
        "x": 1165,
        "y": 1500,
        "wires": []
    },
    {
        "id": "f9efc2c6.8eb75",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "if(typeof msg.params !== \"undefined\" && msg.payload.length === 0) {\n    // estem fent la query des del delete\n    msg.topic = `DELETE FROM low_stock WHERE id=${msg.params.$a}`\n    return msg;\n}\n\nfor(var i = 0; i < msg.payload.length; ++i) {\n    var attributes = Object.values(msg.payload[i]);\n    var boolean = true;\n    for (var j = 5; j < attributes.length - 1; ++j) {\n        if (attributes[4] >= attributes[j] && attributes[j] >= 0) {\n            boolean = false;\n            break;\n        }\n    }\n    if(boolean) {\n        msg.topic = `DELETE FROM low_stock WHERE id=${msg.payload[i].id}`;\n        node.send(msg);\n    }\n}\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 2300,
        "wires": [
            [
                "dd46fcbf.71e3f",
                "46dbf4b0de7ea86a"
            ]
        ]
    },
    {
        "id": "dd46fcbf.71e3f",
        "type": "link out",
        "z": "17245db2.768872",
        "name": "low_stock delete if greater/equal",
        "links": [
            "232288a0.de9958",
            "530feabf.fbd634"
        ],
        "x": 815,
        "y": 2300,
        "wires": []
    },
    {
        "id": "232288a0.de9958",
        "type": "link in",
        "z": "17245db2.768872",
        "name": "",
        "links": [
            "dd46fcbf.71e3f"
        ],
        "x": 275,
        "y": 1320,
        "wires": [
            [
                "7a98bd1.392f744"
            ]
        ]
    },
    {
        "id": "762dbd45.4e5b34",
        "type": "sqlite",
        "z": "17245db2.768872",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "fixed",
        "sql": "SELECT * FROM `low_stock` WHERE `ordered`=1;",
        "name": "INVENTORY",
        "x": 810,
        "y": 2040,
        "wires": [
            [
                "6e4215bf74a0d3eb"
            ]
        ]
    },
    {
        "id": "102159d8.881eb6",
        "type": "inject",
        "z": "17245db2.768872",
        "name": "1W",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "00 08 * * 1",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 470,
        "y": 2040,
        "wires": [
            [
                "762dbd45.4e5b34"
            ]
        ]
    },
    {
        "id": "ad32219d.6f1f2",
        "type": "ui_text_input",
        "z": "17245db2.768872",
        "name": "",
        "label": "reference",
        "tooltip": "",
        "group": "cc23078f.fd1928",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": false,
        "mode": "text",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "topicType": "msg",
        "x": 1280,
        "y": 680,
        "wires": [
            [
                "f600c491.be8a48"
            ]
        ]
    },
    {
        "id": "1e41c977.5a0a97",
        "type": "change",
        "z": "17245db2.768872",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "create_machine",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1510,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "f600c491.be8a48",
        "type": "change",
        "z": "17245db2.768872",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "create_reference",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1270,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "ece8f95e.f8dab8",
        "type": "ui_text_input",
        "z": "17245db2.768872",
        "name": "",
        "label": "reference",
        "tooltip": "",
        "group": "5b84c717.7cfdf8",
        "order": 6,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "topicType": "msg",
        "x": 2300,
        "y": 740,
        "wires": [
            [
                "91c16c22.61199"
            ]
        ]
    },
    {
        "id": "91c16c22.61199",
        "type": "change",
        "z": "17245db2.768872",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "edit_reference",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2570,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "8a97b86a.8666b8",
        "type": "ui_dropdown",
        "z": "17245db2.768872",
        "name": "",
        "label": "location",
        "tooltip": "",
        "place": "Select option",
        "group": "d37d52d.e17c9b",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": false,
        "multiple": false,
        "options": [
            {
                "label": "STB",
                "value": "STB",
                "type": "str"
            },
            {
                "label": "STP",
                "value": "STP",
                "type": "str"
            },
            {
                "label": "STR",
                "value": "STR",
                "type": "str"
            },
            {
                "label": "STM",
                "value": "STM",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 440,
        "y": 1060,
        "wires": [
            [
                "b5c41314.8dd7d",
                "77d0434ba416c5fc"
            ]
        ]
    },
    {
        "id": "b5c41314.8dd7d",
        "type": "change",
        "z": "17245db2.768872",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "user_location",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 650,
        "y": 1060,
        "wires": [
            []
        ]
    },
    {
        "id": "b31fd450.0a5e38",
        "type": "sqlite",
        "z": "17245db2.768872",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "msg.topic",
        "sql": "UPDATE `low_stock` SET `stock_actual`=(`stock_actual`+$b) WHERE `item_id`=$a;",
        "name": "INVENTORY",
        "x": 930,
        "y": 880,
        "wires": [
            [
                "b42dce68.da7db"
            ]
        ]
    },
    {
        "id": "2b63cb9e.218ad4",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "var b = flow.get(\"user_stock\");\nvar a = flow.get(\"user_item\");\nvar c = flow.get(\"user_location\");\n\nmsg.params = {\n    $a: a,\n    $b: b,\n    $c: c\n}\nmsg.topic = \"UPDATE `items` SET `stock_\"+c.toLowerCase()+\"`=(`stock_\"+c.toLowerCase()+\"`+\"+b+\") WHERE `id`=\"+a+\";\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 820,
        "wires": [
            [
                "cd5045bd.be2638",
                "63d40f04fb14a9c0"
            ]
        ]
    },
    {
        "id": "320c5756.dd78c8",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "var b = flow.get(\"user_stock\");\nvar a = flow.get(\"user_item\");\nvar c = flow.get(\"user_location\");\n\nmsg.params = {\n    $a: a,\n    $b: b,\n    $c: c\n}\n\nmsg.topic = \"UPDATE `low_stock` SET `stock_\"+c.toLowerCase()+\"`=(`stock_\"+c.toLowerCase()+\"`+\"+b+\") WHERE `item_id`=\"+a+\";\"\n\n// quan hem acabat desactivem el botó CREATE\nflow.set(\"user_stock\",undefined);\nflow.set(\"user_item\",undefined);\nflow.set(\"user_location\",undefined);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 820,
        "wires": [
            [
                "b31fd450.0a5e38",
                "63d40f04fb14a9c0"
            ]
        ]
    },
    {
        "id": "f0947a70428a3e08",
        "type": "link in",
        "z": "17245db2.768872",
        "name": "",
        "links": [
            "271ce25a.498f0e",
            "4cf35f5b.b7911",
            "76e1504d.e96b8",
            "987a75eb.5344e8",
            "b42dce68.da7db",
            "d37fda0b.b354d8",
            "ef26292d.c7b308"
        ],
        "x": 275,
        "y": 1500,
        "wires": [
            [
                "ce3e4ef5.b3bf2"
            ]
        ]
    },
    {
        "id": "77d0434ba416c5fc",
        "type": "function",
        "z": "17245db2.768872",
        "name": "SET",
        "func": "msg.topic = \"SELECT * FROM `items` WHERE `location` LIKE '%\"+msg.payload+\"%'\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 1100,
        "wires": [
            [
                "d62d8dc21a3e8905"
            ]
        ],
        "icon": "node-red/swap.svg"
    },
    {
        "id": "d62d8dc21a3e8905",
        "type": "sqlite",
        "z": "17245db2.768872",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "INVENTORY",
        "x": 970,
        "y": 1100,
        "wires": [
            [
                "d0b41aec40519ab7"
            ]
        ]
    },
    {
        "id": "d0b41aec40519ab7",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "let array = [];\nfor(let i = 0; i < msg.payload.length; ++i) {\n    let id = msg.payload[i].id;\n    let name = msg.payload[i].name;\n    array.push(JSON.parse(`{\"${name}\":${id}}`));\n}\nmsg.options = array;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 1160,
        "wires": [
            [
                "7569a2b9.0c443c",
                "3273bc786b4330e0"
            ]
        ]
    },
    {
        "id": "3273bc786b4330e0",
        "type": "debug",
        "z": "17245db2.768872",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 970,
        "y": 1160,
        "wires": []
    },
    {
        "id": "9cfd4fef61e092ed",
        "type": "sqlite",
        "z": "17245db2.768872",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "fixed",
        "sql": "SELECT * FROM `items`;",
        "name": "INVENTORY",
        "x": 430,
        "y": 520,
        "wires": [
            [
                "52ff29c1.1ac1e8"
            ]
        ]
    },
    {
        "id": "60021a20070e6d56",
        "type": "inject",
        "z": "17245db2.768872",
        "name": "1S",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 250,
        "y": 460,
        "wires": [
            [
                "ed2af026.faeb8"
            ]
        ]
    },
    {
        "id": "6e4215bf74a0d3eb",
        "type": "function",
        "z": "17245db2.768872",
        "name": "SET",
        "func": "// si el missatge no conté res, no fem res\nif(msg.payload.length === 0) {\n    return msg;\n}\n\nvar string = \"\" // localitzacions que necessiten restock\nvar locations = [\"STB\",\"STR\",\"STP\",\"STM\"]\nfor (var i = 0; i < msg.payload.length; ++i) {\n    var attributes = Object.values(msg.payload[i]);\n    for (var j = 5; j < attributes.length - 1; ++j) {\n        if (attributes[4] >= attributes[j] && attributes[j] >= 0) {\n            var calcul = attributes[4] - attributes[j];\n            string += `${calcul} unit/s of item \"${msg.payload[i].name}\" from plant \"${locations[j-5]}\" are needed to cover minimum stock. `;\n        }\n    }\n}\n\nstring += \"ORDER IS PLACED AND ON ITS WAY.\"; // addició final\n\nmsg.payload = {\n    content: string,\n    type: \"message\",\n    chatId: \"5019177108\"\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1010,
        "y": 2040,
        "wires": [
            [
                "fea2225a.f864e",
                "db0618a32574a28a"
            ]
        ],
        "icon": "node-red/swap.svg"
    },
    {
        "id": "fea2225a.f864e",
        "type": "telegram sender",
        "z": "17245db2.768872",
        "d": true,
        "name": "",
        "bot": "35d1d63d.95944a",
        "haserroroutput": false,
        "outputs": 1,
        "x": 1250,
        "y": 2020,
        "wires": [
            []
        ]
    },
    {
        "id": "63d40f04fb14a9c0",
        "type": "debug",
        "z": "17245db2.768872",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "topic",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1000,
        "y": 760,
        "wires": []
    },
    {
        "id": "46dbf4b0de7ea86a",
        "type": "debug",
        "z": "17245db2.768872",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 850,
        "y": 2360,
        "wires": []
    },
    {
        "id": "fc77da01f2cc47d6",
        "type": "sqlite",
        "z": "17245db2.768872",
        "d": true,
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "fixed",
        "sql": "SELECT * FROM `low_stock` WHERE `ordered`=0",
        "name": "INVENTORY",
        "x": 470,
        "y": 1580,
        "wires": [
            [
                "a8eda3b0.591aa"
            ]
        ]
    },
    {
        "id": "5b6fec072365d05f",
        "type": "debug",
        "z": "17245db2.768872",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 1700,
        "wires": []
    },
    {
        "id": "a76aca0cb6b64a9f",
        "type": "rbe",
        "z": "17245db2.768872",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 290,
        "y": 1640,
        "wires": [
            [
                "fc77da01f2cc47d6"
            ]
        ]
    },
    {
        "id": "db0618a32574a28a",
        "type": "debug",
        "z": "17245db2.768872",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1250,
        "y": 1980,
        "wires": []
    },
    {
        "id": "1e477ee4a39db1f3",
        "type": "inject",
        "z": "17245db2.768872",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1680,
        "y": 980,
        "wires": [
            [
                "eb575ac1e823e9fc"
            ]
        ]
    },
    {
        "id": "eb575ac1e823e9fc",
        "type": "function",
        "z": "17245db2.768872",
        "name": "",
        "func": "// mirem en quines posicions posem stock mínim\nd = [\"STR\"];\nvar all_locations = [\"STB\",\"STR\",\"STP\",\"STM\"];\n\nall_locations.remove(d);\n\nfor (var i = 0; i < all_locations.length; ++i) {\n    msg.topic += `stock_${all_locations[i].toLowerCase()}=-1,`;\n}\n\nmsg.topic = `UPDATE low_stock SET name='',location='',min_stock=`;\n\nmsg.topic += `WHERE item_id=${f}`;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1980,
        "y": 980,
        "wires": [
            [
                "b4a5c20e11330343"
            ]
        ]
    },
    {
        "id": "b4a5c20e11330343",
        "type": "debug",
        "z": "17245db2.768872",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1710,
        "y": 1080,
        "wires": []
    },
    {
        "id": "477ea1383e9375c1",
        "type": "ui_text",
        "z": "17245db2.768872",
        "group": "5b84c717.7cfdf8",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "disclaimer",
        "label": "",
        "format": "editing item will reset stock!",
        "layout": "row-center",
        "className": "",
        "x": 2050,
        "y": 260,
        "wires": []
    },
    {
        "id": "4e96c3cd6b7c4974",
        "type": "debug",
        "z": "17245db2.768872",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 2810,
        "y": 740,
        "wires": []
    },
    {
        "id": "2a825ccb.cc9df4",
        "type": "link out",
        "z": "b12df2de.6ef4d",
        "name": "item",
        "links": [
            "8a36279.bdeb6d8"
        ],
        "x": 815,
        "y": 220,
        "wires": []
    },
    {
        "id": "bae2eda.8cacb1",
        "type": "function",
        "z": "b12df2de.6ef4d",
        "name": "",
        "func": "let array = [];\nfor(let i = 0; i < msg.payload.length; ++i) {\n    let id = msg.payload[i].id;\n    let name = msg.payload[i].name;\n    array.push(JSON.parse(`{\"${name}\":${id}}`));\n}\nmsg.options = array;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 220,
        "wires": [
            [
                "2a825ccb.cc9df4"
            ]
        ]
    },
    {
        "id": "775b5c62.b31f54",
        "type": "ui_table",
        "z": "b12df2de.6ef4d",
        "group": "843b3c3a.d2369",
        "name": "ITEMTABLE TOTAL",
        "order": 2,
        "width": "16",
        "height": "3",
        "columns": [
            {
                "field": "name",
                "title": "NAME",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "location",
                "title": "LOC",
                "width": "10%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "maq",
                "title": "MAQ",
                "width": "10%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "phase",
                "title": "PHASE",
                "width": "15%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "min_stock",
                "title": "MIN-STOCK",
                "width": "15%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "stock_stm",
                "title": "STOCK-NOW",
                "width": "15%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 650,
        "y": 160,
        "wires": []
    },
    {
        "id": "5b5a4050.02bee",
        "type": "sqlite",
        "z": "b12df2de.6ef4d",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "fixed",
        "sql": "SELECT * FROM `items` WHERE `location` LIKE '%STM%';",
        "name": "INVENTORY",
        "x": 350,
        "y": 160,
        "wires": [
            [
                "775b5c62.b31f54",
                "bae2eda.8cacb1"
            ]
        ]
    },
    {
        "id": "39a16ddc.252262",
        "type": "comment",
        "z": "b12df2de.6ef4d",
        "name": "LIST ELEMENTS IN EDITOR",
        "info": "",
        "x": 380,
        "y": 280,
        "wires": []
    },
    {
        "id": "d6152a9.af309d8",
        "type": "comment",
        "z": "b12df2de.6ef4d",
        "name": "TABLE SELECT",
        "info": "",
        "x": 340,
        "y": 100,
        "wires": []
    },
    {
        "id": "8a36279.bdeb6d8",
        "type": "link in",
        "z": "b12df2de.6ef4d",
        "name": "",
        "links": [
            "2a825ccb.cc9df4"
        ],
        "x": 65,
        "y": 680,
        "wires": [
            [
                "56bcba91800367ad"
            ]
        ]
    },
    {
        "id": "98f09d3a.cc6d7",
        "type": "ui_dropdown",
        "z": "b12df2de.6ef4d",
        "name": "",
        "label": "ITEM",
        "tooltip": "",
        "place": "Select option",
        "group": "953c7bf4.36a428",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": false,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 350,
        "y": 680,
        "wires": [
            [
                "85969612.6c7438"
            ]
        ]
    },
    {
        "id": "7d7d9fda.ded38",
        "type": "ui_button",
        "z": "b12df2de.6ef4d",
        "name": "",
        "group": "953c7bf4.36a428",
        "order": 5,
        "width": "16",
        "height": "1",
        "passthru": false,
        "label": "EDIT STOCK",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": " ",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 360,
        "y": 520,
        "wires": [
            [
                "90beef9b.ccf71",
                "fffefd14.f4389"
            ]
        ]
    },
    {
        "id": "f0124a2b.4e61d8",
        "type": "sqlite",
        "z": "b12df2de.6ef4d",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "prepared",
        "sql": "-- UPDATE `items` SET `stock_actual`=((SELECT `stock_actual` FROM `items` WHERE `id`=$a)+$b) WHERE `id`=$a;\nUPDATE `items` SET `stock_stm`=(`stock_stm`+$b) WHERE `id`=$a;",
        "name": "INVENTORY",
        "x": 610,
        "y": 580,
        "wires": [
            [
                "ef26292d.c7b308"
            ]
        ]
    },
    {
        "id": "85969612.6c7438",
        "type": "change",
        "z": "b12df2de.6ef4d",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "user_item",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "fffefd14.f4389",
        "type": "function",
        "z": "b12df2de.6ef4d",
        "name": "",
        "func": "var b = flow.get(\"user_stock\");\nvar a = flow.get(\"user_item\");\n\nmsg.params = {\n    $a: a,\n    $b: b\n}\n\n// msg.topic = \"UPDATE `items` SET `stock_actual`=(SELECT `stock_actual` FROM `items` WHERE `id`=\"+a+\")+\"+b+\" WHERE `id`=\"+a+\"\";\nmsg.topic = \"UPDATE `items` SET `stock_stm`=(`stock_stm`+\"+b+\") WHERE `id`=\"+a+\";\"\n\n// quan hem acabat desactivem el botó CREATE\nflow.set(\"user_stock\",undefined);\nflow.set(\"user_item\",undefined);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 520,
        "wires": [
            [
                "f0124a2b.4e61d8",
                "64b1a13c.17e83"
            ]
        ]
    },
    {
        "id": "252714bf.795e4c",
        "type": "function",
        "z": "b12df2de.6ef4d",
        "name": "",
        "func": "var a = flow.get(\"user_item\") != undefined;\nvar b = flow.get(\"user_stock\") != undefined;\nvar c = flow.get(\"user_stock\") != 0;\nif(a && b && c) {\n    msg.enabled = true;\n} else {\n    msg.enabled = false;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 160,
        "y": 520,
        "wires": [
            [
                "7d7d9fda.ded38"
            ]
        ]
    },
    {
        "id": "b4538cdd.5fbc9",
        "type": "inject",
        "z": "b12df2de.6ef4d",
        "name": "1'",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 160,
        "wires": [
            [
                "252714bf.795e4c",
                "5b5a4050.02bee"
            ]
        ]
    },
    {
        "id": "e94396f0.854868",
        "type": "ui_slider",
        "z": "b12df2de.6ef4d",
        "name": "STOCK USED",
        "label": "STOCK VARIATION",
        "tooltip": "",
        "group": "953c7bf4.36a428",
        "order": 2,
        "width": "14",
        "height": "1",
        "passthru": false,
        "outs": "all",
        "topic": "topic",
        "topicType": "msg",
        "min": "-10",
        "max": 10,
        "step": 1,
        "className": "",
        "x": 600,
        "y": 680,
        "wires": [
            [
                "aa169bab.72af38",
                "252c4fbb.8d23d"
            ]
        ]
    },
    {
        "id": "90beef9b.ccf71",
        "type": "function",
        "z": "b12df2de.6ef4d",
        "name": "",
        "func": "return [{payload: null},{payload: 0}];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 600,
        "wires": [
            [
                "98f09d3a.cc6d7"
            ],
            [
                "e94396f0.854868",
                "252c4fbb.8d23d"
            ]
        ]
    },
    {
        "id": "ef26292d.c7b308",
        "type": "link out",
        "z": "b12df2de.6ef4d",
        "name": "user",
        "mode": "link",
        "links": [
            "f0947a70428a3e08",
            "f175c7e8.f86d18",
            "c5446df4.5f362"
        ],
        "x": 875,
        "y": 580,
        "wires": []
    },
    {
        "id": "aa169bab.72af38",
        "type": "change",
        "z": "b12df2de.6ef4d",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "user_stock",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 570,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "5263802f.53bcb",
        "type": "ui_text",
        "z": "b12df2de.6ef4d",
        "group": "953c7bf4.36a428",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"EDIT STOCK ACTUAL\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 590,
        "y": 440,
        "wires": []
    },
    {
        "id": "252c4fbb.8d23d",
        "type": "ui_text",
        "z": "b12df2de.6ef4d",
        "group": "953c7bf4.36a428",
        "order": 3,
        "width": "2",
        "height": "1",
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC> {{msg.payload}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 850,
        "y": 640,
        "wires": []
    },
    {
        "id": "12b71ca.de641e3",
        "type": "ui_ui_control",
        "z": "b12df2de.6ef4d",
        "name": "",
        "events": "all",
        "x": 580,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "51d01d20.d53ea4",
        "type": "comment",
        "z": "b12df2de.6ef4d",
        "name": "es podria intentar no fer una query extra treballant amb stock actual i el min-stock, per no haver de comprovar tots els ítems",
        "info": "",
        "x": 530,
        "y": 960,
        "wires": []
    },
    {
        "id": "938f6787.54b698",
        "type": "function",
        "z": "b12df2de.6ef4d",
        "name": "",
        "func": "var low_stock = false;\nfor(var i = 0; i < msg.payload.length; ++i) {\n    if(!msg.low.includes(msg.payload[i].id)) {\n        msg.topic = `INSERT INTO low_stock(item_id,name,location,min_stock,stock_stb,stock_str,stock_stp,stock_stm,ordered) VALUES(${msg.payload[i].id},'${msg.payload[i].name}','${msg.payload[i].location}',${msg.payload[i].min_stock},${msg.payload[i].stock_stb},${msg.payload[i].stock_str},${msg.payload[i].stock_stp},${msg.payload[i].stock_stm},0)`;\n    }\n}\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 160,
        "y": 1120,
        "wires": [
            [
                "ad485277.8700e"
            ]
        ]
    },
    {
        "id": "e8327854.f29578",
        "type": "sqlite",
        "z": "b12df2de.6ef4d",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "fixed",
        "sql": "SELECT `item_id` FROM `low_stock` WHERE `location` LIKE '%STM%';",
        "name": "INVENTORY",
        "x": 370,
        "y": 1020,
        "wires": [
            [
                "4f992068.f86b9"
            ]
        ]
    },
    {
        "id": "4f992068.f86b9",
        "type": "function",
        "z": "b12df2de.6ef4d",
        "name": "",
        "func": "// si ens interessés agafar més que l'id podríem canviar el zero\n// per una j i iterar pel nombre de propietats que volguéssim agafar\n\nvar array = []\nfor(var i = 0; i < msg.payload.length; ++i) {\n    array.push(Object.values(msg.payload[i])[0])\n}\nmsg.low = array\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 1020,
        "wires": [
            [
                "d1b7b0ec.67be7"
            ]
        ]
    },
    {
        "id": "d1b7b0ec.67be7",
        "type": "sqlite",
        "z": "b12df2de.6ef4d",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "fixed",
        "sql": "SELECT `id`,`name`,`min_stock`,`stock_stb`,`stock_str`,`stock_stp`,`stock_stm` FROM `items` WHERE `min_stock`>=`stock_stm` AND `stock_stm`>=0;",
        "name": "INVENTORY",
        "x": 870,
        "y": 1020,
        "wires": [
            [
                "938f6787.54b698"
            ]
        ]
    },
    {
        "id": "92af92e.ff2217",
        "type": "sqlite",
        "z": "b12df2de.6ef4d",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "fixed",
        "sql": "SELECT * FROM `low_stock` WHERE `location` LIKE '%STM%';",
        "name": "INVENTORY",
        "x": 610,
        "y": 1200,
        "wires": [
            [
                "635a8cae.e37344",
                "d642bf90.c8fed"
            ]
        ]
    },
    {
        "id": "9ff8c48f.2bc938",
        "type": "comment",
        "z": "b12df2de.6ef4d",
        "name": "COMPROVEM MINSTOCK VS ACTUAL_STOCK",
        "info": "",
        "x": 300,
        "y": 900,
        "wires": []
    },
    {
        "id": "ad485277.8700e",
        "type": "sqlite",
        "z": "b12df2de.6ef4d",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "msg.topic",
        "sql": "SELECT * FROM `low_stock` WHERE `ordered`=0;",
        "name": "INVENTORY",
        "x": 370,
        "y": 1120,
        "wires": [
            []
        ]
    },
    {
        "id": "4175a2e8.48e52c",
        "type": "ui_table",
        "z": "b12df2de.6ef4d",
        "group": "843b3c3a.d2369",
        "name": "ITEMTABLE NOORDERED",
        "order": 4,
        "width": "16",
        "height": "3",
        "columns": [
            {
                "field": "name",
                "title": "NAME",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "min_stock",
                "title": "MIN",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "stock_stm",
                "title": "NOW",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 660,
        "y": 1120,
        "wires": []
    },
    {
        "id": "b37adcbe.db396",
        "type": "delay",
        "z": "b12df2de.6ef4d",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 360,
        "y": 1200,
        "wires": [
            [
                "92af92e.ff2217"
            ]
        ]
    },
    {
        "id": "6d10773e.d1d018",
        "type": "telegram receiver",
        "z": "b12df2de.6ef4d",
        "d": true,
        "name": "EVENT LISTENER",
        "bot": "35d1d63d.95944a",
        "saveDataDir": "",
        "filterCommands": false,
        "x": 1250,
        "y": 940,
        "wires": [
            [
                "1e650b81.013944"
            ],
            [
                "1e650b81.013944"
            ]
        ]
    },
    {
        "id": "1e650b81.013944",
        "type": "function",
        "z": "b12df2de.6ef4d",
        "d": true,
        "name": "",
        "func": "var possibles_respostes = [\"Y\",\"YES\",\"yes\",\"ye\",\"y\",\"s\",\"si\",\"sí\",\"N\",\"n\",\"NO\",\"no\"];\nif(!possibles_respostes.includes(msg.payload.content)) {\n   return [{payload:{\n       content: \"PLEASE TRY AGAIN. BAD INPUT\",\n       type: \"message\",\n       chatId: \"5019177108\"\n   }},null] \n} else {\n    if(possibles_respostes.slice(0,8).includes(msg.payload.content)) {\n        \n    } else if(possibles_respostes.slice(8).includes(msg.payload.content)) {\n        \n    } else {\n        return [{payload:{\n            content: \"PLEASE TRY AGAIN. UNKNOWN ERROR\",\n            type: \"message\",\n            chatId: \"5019177108\"\n        }},null] \n    }\n}\n\nreturn null;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1220,
        "y": 880,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "98d91bd7.bfe488",
        "type": "ui_text",
        "z": "b12df2de.6ef4d",
        "group": "843b3c3a.d2369",
        "order": 5,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"NEED RESTOCK AND HAS BEEN ORDERED\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 1150,
        "y": 1060,
        "wires": []
    },
    {
        "id": "ba1e2a79.8ad478",
        "type": "ui_text",
        "z": "b12df2de.6ef4d",
        "group": "843b3c3a.d2369",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"LIST OF ALL ITEMS\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 150,
        "y": 100,
        "wires": []
    },
    {
        "id": "548f3aed.3ba4d4",
        "type": "ui_text",
        "z": "b12df2de.6ef4d",
        "group": "843b3c3a.d2369",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"NEED RESTOCK NO ORDERED\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 1150,
        "y": 1140,
        "wires": []
    },
    {
        "id": "2451de.6a47ce22",
        "type": "ui_table",
        "z": "b12df2de.6ef4d",
        "group": "843b3c3a.d2369",
        "name": "ITEMTABLE ORDERED",
        "order": 6,
        "width": "16",
        "height": "3",
        "columns": [
            {
                "field": "name",
                "title": "NAME",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "min_stock",
                "title": "MIN",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "stock_stm",
                "title": "NOW",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 890,
        "y": 1300,
        "wires": []
    },
    {
        "id": "7c717e52.380ce",
        "type": "ui_dropdown",
        "z": "b12df2de.6ef4d",
        "name": "",
        "label": "ITEM",
        "tooltip": "",
        "place": "Select option",
        "group": "5de87a9a.808364",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 350,
        "y": 1400,
        "wires": [
            [
                "a406b95e.7488c8"
            ]
        ]
    },
    {
        "id": "fcdd9901.1433d8",
        "type": "ui_button",
        "z": "b12df2de.6ef4d",
        "name": "",
        "group": "5de87a9a.808364",
        "order": 3,
        "width": "16",
        "height": "1",
        "passthru": false,
        "label": "EDIT ORDER STATUS",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": " ",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 400,
        "y": 1520,
        "wires": [
            [
                "393f55c9.3bbb5a",
                "bfd0b7e8.247208"
            ]
        ]
    },
    {
        "id": "72b1ede4.c7e3c4",
        "type": "ui_text",
        "z": "b12df2de.6ef4d",
        "group": "ab942ba8.0ae498",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "ORDER STATUS",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"ORDER ITEM\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 1110,
        "y": 1100,
        "wires": []
    },
    {
        "id": "76f3fff1.c8a47",
        "type": "function",
        "z": "b12df2de.6ef4d",
        "name": "",
        "func": "let array = [];\nfor(let i = 0; i < msg.payload.length; ++i) {\n    let id = msg.payload[i].id;\n    let name = msg.payload[i].name;\n    array.push(JSON.parse(`{\"${name}\":${id}}`));\n}\nmsg.options = array;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 1300,
        "wires": [
            [
                "7c717e52.380ce"
            ]
        ]
    },
    {
        "id": "a818a359.0d4e4",
        "type": "sqlite",
        "z": "b12df2de.6ef4d",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "prepared",
        "sql": "-- UPDATE `items` SET `stock_actual`=((SELECT `stock_actual` FROM `items` WHERE `id`=$a)+$b) WHERE `id`=$a;\nUPDATE `low_stock` SET `ordered`=1 WHERE `id`=$a;",
        "name": "INVENTORY",
        "x": 710,
        "y": 1500,
        "wires": [
            [
                "87a56bb.098ab98"
            ]
        ]
    },
    {
        "id": "751de558.788f5c",
        "type": "link out",
        "z": "b12df2de.6ef4d",
        "name": "ordered",
        "links": [
            "f175c7e8.f86d18",
            "76f84a6d.f5a524"
        ],
        "x": 1035,
        "y": 1500,
        "wires": []
    },
    {
        "id": "393f55c9.3bbb5a",
        "type": "function",
        "z": "b12df2de.6ef4d",
        "name": "",
        "func": "var a = flow.get(\"order_item\");\n\nmsg.params = {\n    $a: a\n}\n\n// quan hem acabat desactivem el botó CREATE\nflow.set(\"order_item\",undefined);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 1400,
        "wires": [
            [
                "a818a359.0d4e4"
            ]
        ]
    },
    {
        "id": "bfd0b7e8.247208",
        "type": "function",
        "z": "b12df2de.6ef4d",
        "name": "SET",
        "func": "msg.payload = null;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 1460,
        "wires": [
            [
                "7c717e52.380ce"
            ]
        ],
        "icon": "node-red/swap.svg"
    },
    {
        "id": "aa0d765a.1ba0d8",
        "type": "inject",
        "z": "b12df2de.6ef4d",
        "name": "1s",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 1620,
        "wires": [
            [
                "a1078d6a.13849"
            ]
        ]
    },
    {
        "id": "a1078d6a.13849",
        "type": "function",
        "z": "b12df2de.6ef4d",
        "name": "",
        "func": "if(flow.get(\"order_item\") != undefined) {\n    msg.enabled = true;\n} else {\n    msg.enabled = false;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 1620,
        "wires": [
            [
                "fcdd9901.1433d8"
            ]
        ]
    },
    {
        "id": "a406b95e.7488c8",
        "type": "change",
        "z": "b12df2de.6ef4d",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "order_item",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 510,
        "y": 1400,
        "wires": [
            []
        ]
    },
    {
        "id": "f175c7e8.f86d18",
        "type": "link in",
        "z": "b12df2de.6ef4d",
        "name": "",
        "links": [
            "751de558.788f5c",
            "76e1504d.e96b8",
            "792f9a1a.4ad0d4",
            "b42dce68.da7db",
            "d642bf90.c8fed",
            "ef26292d.c7b308"
        ],
        "x": 175,
        "y": 1200,
        "wires": [
            [
                "e8327854.f29578",
                "b37adcbe.db396"
            ]
        ]
    },
    {
        "id": "87a56bb.098ab98",
        "type": "delay",
        "z": "b12df2de.6ef4d",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 900,
        "y": 1500,
        "wires": [
            [
                "751de558.788f5c"
            ]
        ]
    },
    {
        "id": "64b1a13c.17e83",
        "type": "sqlite",
        "z": "b12df2de.6ef4d",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "prepared",
        "sql": "-- UPDATE `items` SET `stock_actual`=((SELECT `stock_actual` FROM `items` WHERE `id`=$a)+$b) WHERE `id`=$a;\nUPDATE `low_stock` SET `stock_stm`=(`stock_stm`+$b) WHERE `item_id`=$a;",
        "name": "INVENTORY",
        "x": 830,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "751c4d8.2cb88b4",
        "type": "link in",
        "z": "b12df2de.6ef4d",
        "name": "",
        "links": [
            "d642bf90.c8fed"
        ],
        "x": 155,
        "y": 2000,
        "wires": [
            [
                "728e598f.b9d1b8"
            ]
        ]
    },
    {
        "id": "75e9622c.9c82fc",
        "type": "comment",
        "z": "b12df2de.6ef4d",
        "name": "MIRAREM QUE NO PUGUEM TREURE ALGUN DELS VALORS DE LA LLISTA DE LOW_STOCK (aprofitant queries ja fetes)",
        "info": "",
        "x": 500,
        "y": 1920,
        "wires": []
    },
    {
        "id": "635a8cae.e37344",
        "type": "function",
        "z": "b12df2de.6ef4d",
        "name": "SET msg.payload",
        "func": "var array_order = [];\nvar array_noorder = [];\n\nfor(var i = 0; i < msg.payload.length; ++i) {\n    if(msg.payload[i].ordered === 0) {\n        array_noorder.push(msg.payload[i])\n    } else {\n        array_order.push(msg.payload[i])\n    }\n}\nreturn [{payload: array_noorder},{payload: array_order}];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 1200,
        "wires": [
            [
                "76f3fff1.c8a47",
                "4175a2e8.48e52c"
            ],
            [
                "2451de.6a47ce22"
            ]
        ],
        "icon": "node-red/swap.svg"
    },
    {
        "id": "d642bf90.c8fed",
        "type": "link out",
        "z": "b12df2de.6ef4d",
        "name": "low_stock",
        "links": [
            "751c4d8.2cb88b4",
            "f175c7e8.f86d18"
        ],
        "x": 655,
        "y": 1300,
        "wires": []
    },
    {
        "id": "728e598f.b9d1b8",
        "type": "function",
        "z": "b12df2de.6ef4d",
        "name": "",
        "func": "for(var i = 0; i < msg.payload.length; ++i) {\n    var attributes = Object.values(msg.payload[i]);\n    var boolean = true;\n    for (var j = 5; j < attributes.length - 1; ++j) {\n        if (attributes[4] >= attributes[j] && attributes[j] >= 0) {\n            boolean = false;\n            break;\n        }\n    }\n    if(boolean) {\n        msg.topic = `DELETE FROM low_stock WHERE id=${msg.payload[i].id}`;\n        node.send(msg);\n    }\n}\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 2000,
        "wires": [
            [
                "c75036c7.71b508"
            ]
        ]
    },
    {
        "id": "c75036c7.71b508",
        "type": "link out",
        "z": "b12df2de.6ef4d",
        "name": "low_stock delete if greater/equal",
        "links": [
            "9ca52453.597e58"
        ],
        "x": 715,
        "y": 2000,
        "wires": []
    },
    {
        "id": "9ca52453.597e58",
        "type": "link in",
        "z": "b12df2de.6ef4d",
        "name": "",
        "links": [
            "c75036c7.71b508"
        ],
        "x": 175,
        "y": 1040,
        "wires": [
            [
                "ad485277.8700e"
            ]
        ]
    },
    {
        "id": "b42d1a42.34e808",
        "type": "ui_button",
        "z": "b12df2de.6ef4d",
        "name": "",
        "group": "785b33fd.d1299c",
        "order": 1,
        "width": "8",
        "height": "1",
        "passthru": false,
        "label": "HOME",
        "tooltip": "",
        "color": "white",
        "bgcolor": "black",
        "className": "",
        "icon": "dashboard",
        "payload": "{\"tab\":\"0\"}",
        "payloadType": "json",
        "topic": "",
        "topicType": "str",
        "x": 310,
        "y": 360,
        "wires": [
            [
                "12b71ca.de641e3"
            ]
        ]
    },
    {
        "id": "b32f286c.985de8",
        "type": "ui_text",
        "z": "b12df2de.6ef4d",
        "group": "785b33fd.d1299c",
        "order": 2,
        "width": "8",
        "height": "1",
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"MEXICO\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 150,
        "y": 60,
        "wires": []
    },
    {
        "id": "56bcba91800367ad",
        "type": "rbe",
        "z": "b12df2de.6ef4d",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "options",
        "topi": "topic",
        "x": 170,
        "y": 680,
        "wires": [
            [
                "98f09d3a.cc6d7"
            ]
        ]
    },
    {
        "id": "9868f09a.c4cb3",
        "type": "link out",
        "z": "c2a1f43c.ceb388",
        "name": "item",
        "links": [
            "a8a65fa3.a9c3"
        ],
        "x": 975,
        "y": 400,
        "wires": []
    },
    {
        "id": "e8033c1d.4db8",
        "type": "function",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "func": "let array = [];\nfor(let i = 0; i < msg.payload.length; ++i) {\n    let id = msg.payload[i].id;\n    let name = msg.payload[i].name;\n    array.push(JSON.parse(`{\"${name}\":${id}}`));\n}\nmsg.options = array;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 400,
        "wires": [
            [
                "9868f09a.c4cb3"
            ]
        ]
    },
    {
        "id": "6fd23675.e56de8",
        "type": "ui_table",
        "z": "c2a1f43c.ceb388",
        "group": "e6361d02.78bd9",
        "name": "ITEMTABLE TOTAL",
        "order": 2,
        "width": "16",
        "height": "3",
        "columns": [
            {
                "field": "name",
                "title": "NAME",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "location",
                "title": "LOC",
                "width": "10%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "maq",
                "title": "MAQ",
                "width": "10%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "phase",
                "title": "PHASE",
                "width": "15%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "min_stock",
                "title": "MIN-STOCK",
                "width": "15%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "stock_str",
                "title": "STOCK-NOW",
                "width": "15%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 770,
        "y": 340,
        "wires": []
    },
    {
        "id": "91a5942d.5815c8",
        "type": "sqlite",
        "z": "c2a1f43c.ceb388",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "fixed",
        "sql": "SELECT * FROM `items` WHERE `location` LIKE '%STR%';",
        "name": "INVENTORY",
        "x": 490,
        "y": 340,
        "wires": [
            [
                "6fd23675.e56de8",
                "e8033c1d.4db8"
            ]
        ]
    },
    {
        "id": "a19d3d6e.cf947",
        "type": "comment",
        "z": "c2a1f43c.ceb388",
        "name": "LIST ELEMENTS IN EDITOR",
        "info": "",
        "x": 540,
        "y": 460,
        "wires": []
    },
    {
        "id": "d8926aca.eb3688",
        "type": "comment",
        "z": "c2a1f43c.ceb388",
        "name": "TABLE SELECT",
        "info": "",
        "x": 500,
        "y": 280,
        "wires": []
    },
    {
        "id": "a8a65fa3.a9c3",
        "type": "link in",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "links": [
            "9868f09a.c4cb3"
        ],
        "x": 195,
        "y": 860,
        "wires": [
            [
                "32fae7c48c01c94a"
            ]
        ]
    },
    {
        "id": "77bcc00f.99dde",
        "type": "ui_dropdown",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "label": "ITEM",
        "tooltip": "",
        "place": "Select option",
        "group": "eab13a32.b8f2a8",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": false,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 510,
        "y": 860,
        "wires": [
            [
                "85bd1769.20ca98",
                "9a747b239cd13e52"
            ]
        ]
    },
    {
        "id": "ab755ee9.33e84",
        "type": "ui_button",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "group": "eab13a32.b8f2a8",
        "order": 5,
        "width": "16",
        "height": "1",
        "passthru": false,
        "label": "EDIT STOCK",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": " ",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 520,
        "y": 700,
        "wires": [
            [
                "7c2178af.5fdc68",
                "73b21cd9.b47af4"
            ]
        ]
    },
    {
        "id": "9a9b128d.0b293",
        "type": "sqlite",
        "z": "c2a1f43c.ceb388",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "prepared",
        "sql": "-- UPDATE `items` SET `stock_actual`=((SELECT `stock_actual` FROM `items` WHERE `id`=$a)+$b) WHERE `id`=$a;\nUPDATE `items` SET `stock_str`=(`stock_str`+$b) WHERE `id`=$a;",
        "name": "INVENTORY",
        "x": 770,
        "y": 760,
        "wires": [
            [
                "4cf35f5b.b7911"
            ]
        ]
    },
    {
        "id": "85bd1769.20ca98",
        "type": "change",
        "z": "c2a1f43c.ceb388",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "user_item",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 370,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "73b21cd9.b47af4",
        "type": "function",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "func": "var b = flow.get(\"user_stock\");\nvar a = flow.get(\"user_item\");\n\nmsg.params = {\n    $a: a,\n    $b: b\n}\n\n// msg.topic = \"UPDATE `items` SET `stock_actual`=(SELECT `stock_actual` FROM `items` WHERE `id`=\"+a+\")+\"+b+\" WHERE `id`=\"+a+\"\";\nmsg.topic = \"UPDATE `items` SET `stock_str`=(`stock_str`+\"+b+\") WHERE `id`=\"+a+\";\"\n\n// quan hem acabat desactivem el botó CREATE\nflow.set(\"user_stock\",undefined);\nflow.set(\"user_item\",undefined);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 700,
        "wires": [
            [
                "9a9b128d.0b293",
                "b6143f8f.36752"
            ]
        ]
    },
    {
        "id": "9cb70cd5.d441e",
        "type": "function",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "func": "var a = flow.get(\"user_item\") != undefined;\nvar b = flow.get(\"user_stock\") != undefined;\nvar c = flow.get(\"user_stock\") != 0;\nif(a && b && c) {\n    msg.enabled = true;\n} else {\n    msg.enabled = false;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 700,
        "wires": [
            [
                "ab755ee9.33e84"
            ]
        ]
    },
    {
        "id": "b61c86b2.7da5a8",
        "type": "inject",
        "z": "c2a1f43c.ceb388",
        "name": "1'",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 340,
        "wires": [
            [
                "9cb70cd5.d441e",
                "91a5942d.5815c8"
            ]
        ]
    },
    {
        "id": "9d501570.59c4c8",
        "type": "ui_slider",
        "z": "c2a1f43c.ceb388",
        "name": "STOCK USED",
        "label": "STOCK VARIATION",
        "tooltip": "",
        "group": "eab13a32.b8f2a8",
        "order": 2,
        "width": "14",
        "height": "1",
        "passthru": false,
        "outs": "all",
        "topic": "topic",
        "topicType": "msg",
        "min": "-10",
        "max": 10,
        "step": 1,
        "className": "",
        "x": 760,
        "y": 860,
        "wires": [
            [
                "a9b144ff.574648",
                "db1c1108.bcefc"
            ]
        ]
    },
    {
        "id": "7c2178af.5fdc68",
        "type": "function",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "func": "return [{payload: null},{payload: 0}];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 780,
        "wires": [
            [
                "77bcc00f.99dde"
            ],
            [
                "9d501570.59c4c8",
                "db1c1108.bcefc"
            ]
        ]
    },
    {
        "id": "4cf35f5b.b7911",
        "type": "link out",
        "z": "c2a1f43c.ceb388",
        "name": "user",
        "mode": "link",
        "links": [
            "3ecc57b7.5ba128",
            "c5446df4.5f362",
            "f0947a70428a3e08"
        ],
        "x": 1035,
        "y": 760,
        "wires": []
    },
    {
        "id": "a9b144ff.574648",
        "type": "change",
        "z": "c2a1f43c.ceb388",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "user_stock",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 730,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "f6e17f8b.2d71e",
        "type": "ui_text",
        "z": "c2a1f43c.ceb388",
        "group": "eab13a32.b8f2a8",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"EDIT STOCK ACTUAL\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 730,
        "y": 620,
        "wires": []
    },
    {
        "id": "db1c1108.bcefc",
        "type": "ui_text",
        "z": "c2a1f43c.ceb388",
        "group": "eab13a32.b8f2a8",
        "order": 3,
        "width": "2",
        "height": "1",
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC> {{msg.payload}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 1010,
        "y": 820,
        "wires": []
    },
    {
        "id": "4d1ec4c2.7a5a4c",
        "type": "ui_button",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "group": "8da86d5c.844a1",
        "order": 1,
        "width": "8",
        "height": "1",
        "passthru": false,
        "label": "HOME",
        "tooltip": "",
        "color": "white",
        "bgcolor": "black",
        "className": "",
        "icon": "dashboard",
        "payload": "{\"tab\":\"0\"}",
        "payloadType": "json",
        "topic": "",
        "topicType": "str",
        "x": 490,
        "y": 540,
        "wires": [
            [
                "f74cb7ad.348818"
            ]
        ]
    },
    {
        "id": "f74cb7ad.348818",
        "type": "ui_ui_control",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "events": "all",
        "x": 740,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "a88c8daf.74de7",
        "type": "comment",
        "z": "c2a1f43c.ceb388",
        "name": "es podria intentar no fer una query extra treballant amb stock actual i el min-stock, per no haver de comprovar tots els ítems",
        "info": "",
        "x": 690,
        "y": 1140,
        "wires": []
    },
    {
        "id": "6f7ebaa0.09aff4",
        "type": "function",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "func": "var low_stock = false;\nfor(var i = 0; i < msg.payload.length; ++i) {\n    if(!msg.low.includes(msg.payload[i].id)) {\n        msg.topic = `INSERT INTO low_stock(item_id,name,location,min_stock,stock_stb,stock_str,stock_stp,stock_stm,ordered) VALUES(${msg.payload[i].id},'${msg.payload[i].name}','${msg.payload[i].location}',${msg.payload[i].min_stock},${msg.payload[i].stock_stb},${msg.payload[i].stock_str},${msg.payload[i].stock_stp},${msg.payload[i].stock_stm},0)`;\n        node.send(msg);\n    }\n}\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 1300,
        "wires": [
            [
                "f90ddd78.e92a8"
            ]
        ]
    },
    {
        "id": "38491600.3e393a",
        "type": "sqlite",
        "z": "c2a1f43c.ceb388",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "fixed",
        "sql": "SELECT `item_id` FROM `low_stock` WHERE `location` LIKE '%STR%';",
        "name": "INVENTORY",
        "x": 530,
        "y": 1200,
        "wires": [
            [
                "f143cd4c.f74fa"
            ]
        ]
    },
    {
        "id": "f143cd4c.f74fa",
        "type": "function",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "func": "// si ens interessés agafar més que l'id podríem canviar el zero\n// per una j i iterar pel nombre de propietats que volguéssim agafar\n\nvar array = []\nfor(var i = 0; i < msg.payload.length; ++i) {\n    array.push(Object.values(msg.payload[i])[0])\n}\nmsg.low = array\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 1200,
        "wires": [
            [
                "f88f94.e36ea07"
            ]
        ]
    },
    {
        "id": "f88f94.e36ea07",
        "type": "sqlite",
        "z": "c2a1f43c.ceb388",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "fixed",
        "sql": "SELECT `id`,`name`,`min_stock`,`stock_stb`,`stock_str`,`stock_stp`,`stock_stm` FROM `items` WHERE `min_stock`>=`stock_str` AND `stock_str`>=0;",
        "name": "INVENTORY",
        "x": 1030,
        "y": 1200,
        "wires": [
            [
                "6f7ebaa0.09aff4"
            ]
        ]
    },
    {
        "id": "4c09917c.194d6",
        "type": "sqlite",
        "z": "c2a1f43c.ceb388",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "fixed",
        "sql": "SELECT * FROM `low_stock` WHERE `location` LIKE '%STR%';",
        "name": "INVENTORY",
        "x": 770,
        "y": 1380,
        "wires": [
            [
                "5f1a9b05.5df254",
                "e6c4085e.153a38"
            ]
        ]
    },
    {
        "id": "975728b.ff1e9d8",
        "type": "comment",
        "z": "c2a1f43c.ceb388",
        "name": "COMPROVEM MINSTOCK VS ACTUAL_STOCK",
        "info": "",
        "x": 460,
        "y": 1080,
        "wires": []
    },
    {
        "id": "f90ddd78.e92a8",
        "type": "sqlite",
        "z": "c2a1f43c.ceb388",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "msg.topic",
        "sql": "SELECT * FROM `low_stock` WHERE `ordered`=0;",
        "name": "INVENTORY",
        "x": 530,
        "y": 1300,
        "wires": [
            []
        ]
    },
    {
        "id": "f9014612.fa2278",
        "type": "ui_table",
        "z": "c2a1f43c.ceb388",
        "group": "e6361d02.78bd9",
        "name": "ITEMTABLE NOORDERED",
        "order": 4,
        "width": "16",
        "height": "3",
        "columns": [
            {
                "field": "name",
                "title": "NAME",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "min_stock",
                "title": "MIN",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "stock_str",
                "title": "NOW",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 820,
        "y": 1300,
        "wires": []
    },
    {
        "id": "60702ac1.98f2f4",
        "type": "delay",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 520,
        "y": 1380,
        "wires": [
            [
                "4c09917c.194d6"
            ]
        ]
    },
    {
        "id": "641999fb.6d5978",
        "type": "telegram receiver",
        "z": "c2a1f43c.ceb388",
        "d": true,
        "name": "EVENT LISTENER",
        "bot": "35d1d63d.95944a",
        "saveDataDir": "",
        "filterCommands": false,
        "x": 1410,
        "y": 1120,
        "wires": [
            [
                "e3b90fcf.bdc4a"
            ],
            [
                "e3b90fcf.bdc4a"
            ]
        ]
    },
    {
        "id": "e3b90fcf.bdc4a",
        "type": "function",
        "z": "c2a1f43c.ceb388",
        "d": true,
        "name": "",
        "func": "var possibles_respostes = [\"Y\",\"YES\",\"yes\",\"ye\",\"y\",\"s\",\"si\",\"sí\",\"N\",\"n\",\"NO\",\"no\"];\nif(!possibles_respostes.includes(msg.payload.content)) {\n   return [{payload:{\n       content: \"PLEASE TRY AGAIN. BAD INPUT\",\n       type: \"message\",\n       chatId: \"5019177108\"\n   }},null] \n} else {\n    if(possibles_respostes.slice(0,8).includes(msg.payload.content)) {\n        \n    } else if(possibles_respostes.slice(8).includes(msg.payload.content)) {\n        \n    } else {\n        return [{payload:{\n            content: \"PLEASE TRY AGAIN. UNKNOWN ERROR\",\n            type: \"message\",\n            chatId: \"5019177108\"\n        }},null] \n    }\n}\n\nreturn null;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1380,
        "y": 1060,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "83348409.a56f18",
        "type": "ui_text",
        "z": "c2a1f43c.ceb388",
        "group": "e6361d02.78bd9",
        "order": 5,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"NEED RESTOCK AND HAS BEEN ORDERED\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 1310,
        "y": 1240,
        "wires": []
    },
    {
        "id": "6533ac0c.16fba4",
        "type": "ui_text",
        "z": "c2a1f43c.ceb388",
        "group": "e6361d02.78bd9",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"LIST OF ALL ITEMS\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 470,
        "y": 200,
        "wires": []
    },
    {
        "id": "83cbaecc.161ff",
        "type": "ui_text",
        "z": "c2a1f43c.ceb388",
        "group": "e6361d02.78bd9",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"NEED RESTOCK NO ORDERED\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 1310,
        "y": 1320,
        "wires": []
    },
    {
        "id": "7dce8136.f012d",
        "type": "ui_table",
        "z": "c2a1f43c.ceb388",
        "group": "e6361d02.78bd9",
        "name": "ITEMTABLE ORDERED",
        "order": 6,
        "width": "16",
        "height": "3",
        "columns": [
            {
                "field": "name",
                "title": "NAME",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "min_stock",
                "title": "MIN",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "stock_str",
                "title": "NOW",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 1050,
        "y": 1480,
        "wires": []
    },
    {
        "id": "24383db5.56a262",
        "type": "ui_dropdown",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "label": "ITEM",
        "tooltip": "",
        "place": "Select option",
        "group": "31e8d87b.ae0988",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 510,
        "y": 1580,
        "wires": [
            [
                "659d91a7.c8be9"
            ]
        ]
    },
    {
        "id": "4fb3962d.3a5918",
        "type": "ui_button",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "group": "31e8d87b.ae0988",
        "order": 3,
        "width": "16",
        "height": "1",
        "passthru": false,
        "label": "EDIT ORDER STATUS",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": " ",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 560,
        "y": 1700,
        "wires": [
            [
                "c950ae2e.8077c",
                "b0fc91cf.072dd"
            ]
        ]
    },
    {
        "id": "1bffcd77.999a13",
        "type": "ui_text",
        "z": "c2a1f43c.ceb388",
        "group": "5c4c59cc.bc44f8",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "ORDER STATUS",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"ORDER ITEM\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 1270,
        "y": 1280,
        "wires": []
    },
    {
        "id": "443f7dc0.6a6d24",
        "type": "function",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "func": "let array = [];\nfor(let i = 0; i < msg.payload.length; ++i) {\n    let id = msg.payload[i].id;\n    let name = msg.payload[i].name;\n    array.push(JSON.parse(`{\"${name}\":${id}}`));\n}\nmsg.options = array;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 1480,
        "wires": [
            [
                "24383db5.56a262"
            ]
        ]
    },
    {
        "id": "4084243f.48f1dc",
        "type": "sqlite",
        "z": "c2a1f43c.ceb388",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "prepared",
        "sql": "-- UPDATE `items` SET `stock_actual`=((SELECT `stock_actual` FROM `items` WHERE `id`=$a)+$b) WHERE `id`=$a;\nUPDATE `low_stock` SET `ordered`=1 WHERE `id`=$a;",
        "name": "INVENTORY",
        "x": 870,
        "y": 1680,
        "wires": [
            [
                "4fae142a.b0511c"
            ]
        ]
    },
    {
        "id": "9ef00134.f7c5f",
        "type": "link out",
        "z": "c2a1f43c.ceb388",
        "name": "ordered",
        "links": [
            "3ecc57b7.5ba128",
            "76f84a6d.f5a524"
        ],
        "x": 1195,
        "y": 1680,
        "wires": []
    },
    {
        "id": "c950ae2e.8077c",
        "type": "function",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "func": "var a = flow.get(\"order_item\");\n\nmsg.params = {\n    $a: a\n}\n\n// quan hem acabat desactivem el botó CREATE\nflow.set(\"order_item\",undefined);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 1580,
        "wires": [
            [
                "4084243f.48f1dc"
            ]
        ]
    },
    {
        "id": "b0fc91cf.072dd",
        "type": "function",
        "z": "c2a1f43c.ceb388",
        "name": "SET",
        "func": "msg.payload = null;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 1640,
        "wires": [
            [
                "24383db5.56a262"
            ]
        ],
        "icon": "node-red/swap.svg"
    },
    {
        "id": "361666a0.3eb49a",
        "type": "inject",
        "z": "c2a1f43c.ceb388",
        "name": "1s",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 1800,
        "wires": [
            [
                "801c820e.6c4fc"
            ]
        ]
    },
    {
        "id": "801c820e.6c4fc",
        "type": "function",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "func": "if(flow.get(\"order_item\") != undefined) {\n    msg.enabled = true;\n} else {\n    msg.enabled = false;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 1800,
        "wires": [
            [
                "4fb3962d.3a5918"
            ]
        ]
    },
    {
        "id": "659d91a7.c8be9",
        "type": "change",
        "z": "c2a1f43c.ceb388",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "order_item",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 1580,
        "wires": [
            []
        ]
    },
    {
        "id": "3ecc57b7.5ba128",
        "type": "link in",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "links": [
            "4cf35f5b.b7911",
            "76e1504d.e96b8",
            "792f9a1a.4ad0d4",
            "9ef00134.f7c5f",
            "b42dce68.da7db",
            "e6c4085e.153a38"
        ],
        "x": 335,
        "y": 1380,
        "wires": [
            [
                "38491600.3e393a",
                "60702ac1.98f2f4"
            ]
        ]
    },
    {
        "id": "4fae142a.b0511c",
        "type": "delay",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 1060,
        "y": 1680,
        "wires": [
            [
                "9ef00134.f7c5f"
            ]
        ]
    },
    {
        "id": "b6143f8f.36752",
        "type": "sqlite",
        "z": "c2a1f43c.ceb388",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "prepared",
        "sql": "-- UPDATE `items` SET `stock_actual`=((SELECT `stock_actual` FROM `items` WHERE `id`=$a)+$b) WHERE `id`=$a;\nUPDATE `low_stock` SET `stock_str`=(`stock_str`+$b) WHERE `item_id`=$a;",
        "name": "INVENTORY",
        "x": 990,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "cb193e65.7bb92",
        "type": "link in",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "links": [
            "e6c4085e.153a38"
        ],
        "x": 315,
        "y": 2180,
        "wires": [
            [
                "a5c35438.957408"
            ]
        ]
    },
    {
        "id": "a05e2ef.07b57d",
        "type": "comment",
        "z": "c2a1f43c.ceb388",
        "name": "MIRAREM QUE NO PUGUEM TREURE ALGUN DELS VALORS DE LA LLISTA DE LOW_STOCK (aprofitant queries ja fetes)",
        "info": "",
        "x": 660,
        "y": 2100,
        "wires": []
    },
    {
        "id": "5f1a9b05.5df254",
        "type": "function",
        "z": "c2a1f43c.ceb388",
        "name": "SET msg.payload",
        "func": "var array_order = [];\nvar array_noorder = [];\n\nfor(var i = 0; i < msg.payload.length; ++i) {\n    if(msg.payload[i].ordered === 0) {\n        array_noorder.push(msg.payload[i])\n    } else {\n        array_order.push(msg.payload[i])\n    }\n}\nreturn [{payload: array_noorder},{payload: array_order}];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1030,
        "y": 1380,
        "wires": [
            [
                "443f7dc0.6a6d24",
                "f9014612.fa2278"
            ],
            [
                "7dce8136.f012d"
            ]
        ],
        "icon": "node-red/swap.svg"
    },
    {
        "id": "e6c4085e.153a38",
        "type": "link out",
        "z": "c2a1f43c.ceb388",
        "name": "low_stock",
        "links": [
            "cb193e65.7bb92",
            "3ecc57b7.5ba128"
        ],
        "x": 815,
        "y": 1480,
        "wires": []
    },
    {
        "id": "a5c35438.957408",
        "type": "function",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "func": "for(var i = 0; i < msg.payload.length; ++i) {\n    var attributes = Object.values(msg.payload[i]);\n    var boolean = true;\n    for (var j = 5; j < attributes.length - 1; ++j) {\n        if (attributes[4] >= attributes[j] && attributes[j] >= 0) {\n            boolean = false;\n            break;\n        }\n    }\n    if(boolean) {\n        msg.topic = `DELETE FROM low_stock WHERE id=${msg.payload[i].id}`;\n        node.send(msg);\n    }\n}\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 2180,
        "wires": [
            [
                "4f2fc019.024be",
                "da057c310b32c19d"
            ]
        ]
    },
    {
        "id": "4f2fc019.024be",
        "type": "link out",
        "z": "c2a1f43c.ceb388",
        "name": "low_stock delete if greater/equal",
        "links": [
            "c3d8ee52.a4453"
        ],
        "x": 875,
        "y": 2180,
        "wires": []
    },
    {
        "id": "c3d8ee52.a4453",
        "type": "link in",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "links": [
            "4f2fc019.024be"
        ],
        "x": 335,
        "y": 1220,
        "wires": [
            [
                "f90ddd78.e92a8"
            ]
        ]
    },
    {
        "id": "6abf21c1.c555",
        "type": "ui_text",
        "z": "c2a1f43c.ceb388",
        "group": "8da86d5c.844a1",
        "order": 2,
        "width": "8",
        "height": "1",
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"ROMANIA\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 470,
        "y": 160,
        "wires": []
    },
    {
        "id": "9a747b239cd13e52",
        "type": "debug",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 750,
        "y": 980,
        "wires": []
    },
    {
        "id": "32fae7c48c01c94a",
        "type": "rbe",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "options",
        "topi": "topic",
        "x": 310,
        "y": 860,
        "wires": [
            [
                "77bcc00f.99dde"
            ]
        ]
    },
    {
        "id": "da057c310b32c19d",
        "type": "debug",
        "z": "c2a1f43c.ceb388",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 910,
        "y": 2240,
        "wires": []
    },
    {
        "id": "8b9b5b93.a6da78",
        "type": "link out",
        "z": "a9ff7244.7e88c",
        "name": "item",
        "links": [
            "c3bfd81d.97a1e8"
        ],
        "x": 805,
        "y": 160,
        "wires": []
    },
    {
        "id": "298299f2.cba816",
        "type": "function",
        "z": "a9ff7244.7e88c",
        "name": "",
        "func": "let array = [];\nfor(let i = 0; i < msg.payload.length; ++i) {\n    let id = msg.payload[i].id;\n    let name = msg.payload[i].name;\n    array.push(JSON.parse(`{\"${name}\":${id}}`));\n}\nmsg.options = array;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 160,
        "wires": [
            [
                "8b9b5b93.a6da78"
            ]
        ]
    },
    {
        "id": "d5cfcd4d.86d55",
        "type": "ui_table",
        "z": "a9ff7244.7e88c",
        "group": "eb462800.3d9528",
        "name": "ITEMTABLE TOTAL",
        "order": 2,
        "width": "16",
        "height": "3",
        "columns": [
            {
                "field": "name",
                "title": "NAME",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "location",
                "title": "LOC",
                "width": "10%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "maq",
                "title": "MAQ",
                "width": "10%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "phase",
                "title": "PHASE",
                "width": "15%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "min_stock",
                "title": "MIN-STOCK",
                "width": "15%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "stock_stp",
                "title": "STOCK-NOW",
                "width": "15%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 650,
        "y": 120,
        "wires": []
    },
    {
        "id": "71e5bf1b.df45a",
        "type": "sqlite",
        "z": "a9ff7244.7e88c",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "fixed",
        "sql": "SELECT * FROM `items`WHERE `location` LIKE '%STP%' ;",
        "name": "INVENTORY",
        "x": 370,
        "y": 140,
        "wires": [
            [
                "d5cfcd4d.86d55",
                "298299f2.cba816"
            ]
        ]
    },
    {
        "id": "8918c57d.408c68",
        "type": "comment",
        "z": "a9ff7244.7e88c",
        "name": "LIST ELEMENTS IN EDITOR",
        "info": "",
        "x": 465,
        "y": 260,
        "wires": []
    },
    {
        "id": "440acb1f.ca00f4",
        "type": "comment",
        "z": "a9ff7244.7e88c",
        "name": "TABLE SELECT",
        "info": "",
        "x": 385,
        "y": 80,
        "wires": []
    },
    {
        "id": "c3bfd81d.97a1e8",
        "type": "link in",
        "z": "a9ff7244.7e88c",
        "name": "",
        "links": [
            "8b9b5b93.a6da78"
        ],
        "x": 65,
        "y": 660,
        "wires": [
            [
                "bbe6fe61a4cca181"
            ]
        ]
    },
    {
        "id": "f0ff24ee.a3e8d8",
        "type": "ui_dropdown",
        "z": "a9ff7244.7e88c",
        "name": "",
        "label": "ITEM",
        "tooltip": "",
        "place": "Select option",
        "group": "930903de.bb3f",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": false,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 365,
        "y": 660,
        "wires": [
            [
                "ba8da8a.eaf8758"
            ]
        ]
    },
    {
        "id": "4a201ef3.77d71",
        "type": "ui_button",
        "z": "a9ff7244.7e88c",
        "name": "",
        "group": "930903de.bb3f",
        "order": 5,
        "width": "16",
        "height": "1",
        "passthru": false,
        "label": "EDIT STOCK",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": " ",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 405,
        "y": 500,
        "wires": [
            [
                "9ca0e222.e50db",
                "8d935707.02dfd8"
            ]
        ]
    },
    {
        "id": "573b380.54347c8",
        "type": "sqlite",
        "z": "a9ff7244.7e88c",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "prepared",
        "sql": "-- UPDATE `items` SET `stock_actual`=((SELECT `stock_actual` FROM `items` WHERE `id`=$a)+$b) WHERE `id`=$a;\nUPDATE `items` SET `stock_stp`=(`stock_stp`+$b) WHERE `id`=$a;",
        "name": "INVENTORY",
        "x": 645,
        "y": 560,
        "wires": [
            [
                "d37fda0b.b354d8"
            ]
        ]
    },
    {
        "id": "ba8da8a.eaf8758",
        "type": "change",
        "z": "a9ff7244.7e88c",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "user_item",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 365,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "8d935707.02dfd8",
        "type": "function",
        "z": "a9ff7244.7e88c",
        "name": "",
        "func": "var b = flow.get(\"user_stock\");\nvar a = flow.get(\"user_item\");\n\nmsg.params = {\n    $a: a,\n    $b: b\n}\n\n// msg.topic = \"UPDATE `items` SET `stock_actual`=(SELECT `stock_actual` FROM `items` WHERE `id`=\"+a+\")+\"+b+\" WHERE `id`=\"+a+\"\";\nmsg.topic = \"UPDATE `items` SET `stock_stp`=(`stock_stp`+\"+b+\") WHERE `id`=\"+a+\";\"\n\n// quan hem acabat desactivem el botó CREATE\nflow.set(\"user_stock\",undefined);\nflow.set(\"user_item\",undefined);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 625,
        "y": 500,
        "wires": [
            [
                "573b380.54347c8",
                "612d636.1e3809c"
            ]
        ]
    },
    {
        "id": "bc1211c.ea1e2f",
        "type": "function",
        "z": "a9ff7244.7e88c",
        "name": "",
        "func": "var a = flow.get(\"user_item\") != undefined;\nvar b = flow.get(\"user_stock\") != undefined;\nvar c = flow.get(\"user_stock\") != 0;\nif(a && b && c) {\n    msg.enabled = true;\n} else {\n    msg.enabled = false;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 185,
        "y": 500,
        "wires": [
            [
                "4a201ef3.77d71"
            ]
        ]
    },
    {
        "id": "c7fc4a83.950318",
        "type": "inject",
        "z": "a9ff7244.7e88c",
        "name": "1'",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 140,
        "wires": [
            [
                "bc1211c.ea1e2f",
                "71e5bf1b.df45a"
            ]
        ]
    },
    {
        "id": "4a1c390c.f84d38",
        "type": "ui_slider",
        "z": "a9ff7244.7e88c",
        "name": "STOCK USED",
        "label": "STOCK VARIATION",
        "tooltip": "",
        "group": "930903de.bb3f",
        "order": 2,
        "width": "14",
        "height": "1",
        "passthru": false,
        "outs": "all",
        "topic": "topic",
        "topicType": "msg",
        "min": "-10",
        "max": 10,
        "step": 1,
        "className": "",
        "x": 645,
        "y": 660,
        "wires": [
            [
                "d539a535.f83bd8",
                "1f3ffbf.c0dbb04"
            ]
        ]
    },
    {
        "id": "9ca0e222.e50db",
        "type": "function",
        "z": "a9ff7244.7e88c",
        "name": "",
        "func": "return [{payload: null},{payload: 0}];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 365,
        "y": 580,
        "wires": [
            [
                "f0ff24ee.a3e8d8"
            ],
            [
                "4a1c390c.f84d38",
                "1f3ffbf.c0dbb04"
            ]
        ]
    },
    {
        "id": "d37fda0b.b354d8",
        "type": "link out",
        "z": "a9ff7244.7e88c",
        "name": "user",
        "links": [
            "bc7560d7.53ee2",
            "f0947a70428a3e08",
            "c5446df4.5f362"
        ],
        "x": 925,
        "y": 560,
        "wires": []
    },
    {
        "id": "d539a535.f83bd8",
        "type": "change",
        "z": "a9ff7244.7e88c",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "user_stock",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 585,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "bab521c.ceb10e",
        "type": "ui_text",
        "z": "a9ff7244.7e88c",
        "group": "930903de.bb3f",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"EDIT STOCK ACTUAL\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 585,
        "y": 420,
        "wires": []
    },
    {
        "id": "1f3ffbf.c0dbb04",
        "type": "ui_text",
        "z": "a9ff7244.7e88c",
        "group": "930903de.bb3f",
        "order": 3,
        "width": "2",
        "height": "1",
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC> {{msg.payload}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 890,
        "y": 620,
        "wires": []
    },
    {
        "id": "eb1c911b.3425c",
        "type": "ui_ui_control",
        "z": "a9ff7244.7e88c",
        "name": "",
        "events": "all",
        "x": 605,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "76e03df5.c14c24",
        "type": "comment",
        "z": "a9ff7244.7e88c",
        "name": "es podria intentar no fer una query extra treballant amb stock actual i el min-stock, per no haver de comprovar tots els ítems",
        "info": "",
        "x": 905,
        "y": 940,
        "wires": []
    },
    {
        "id": "762091d8.42c72",
        "type": "function",
        "z": "a9ff7244.7e88c",
        "name": "",
        "func": "var low_stock = false;\nfor(var i = 0; i < msg.payload.length; ++i) {\n    if(!msg.low.includes(msg.payload[i].id)) {\n        msg.topic = `INSERT INTO low_stock(item_id,name,location,min_stock,stock_stb,stock_str,stock_stp,stock_stm,ordered) VALUES(${msg.payload[i].id},'${msg.payload[i].name}','${msg.payload[i].location}',${msg.payload[i].min_stock},${msg.payload[i].stock_stb},${msg.payload[i].stock_str},${msg.payload[i].stock_stp},${msg.payload[i].stock_stm},0)`;\n        node.send(msg);\n    }\n}\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 185,
        "y": 1100,
        "wires": [
            [
                "b42affb9.1a0b3"
            ]
        ]
    },
    {
        "id": "2ca58c59.9d9a74",
        "type": "sqlite",
        "z": "a9ff7244.7e88c",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "fixed",
        "sql": "SELECT `item_id` FROM `low_stock` WHERE `location` LIKE '%STP%';",
        "name": "INVENTORY",
        "x": 405,
        "y": 1000,
        "wires": [
            [
                "cafda321.262a2"
            ]
        ]
    },
    {
        "id": "cafda321.262a2",
        "type": "function",
        "z": "a9ff7244.7e88c",
        "name": "",
        "func": "// si ens interessés agafar més que l'id podríem canviar el zero\n// per una j i iterar pel nombre de propietats que volguéssim agafar\n\nvar array = []\nfor(var i = 0; i < msg.payload.length; ++i) {\n    array.push(Object.values(msg.payload[i])[0])\n}\nmsg.low = array\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 625,
        "y": 1000,
        "wires": [
            [
                "c296c249.daa59"
            ]
        ]
    },
    {
        "id": "c296c249.daa59",
        "type": "sqlite",
        "z": "a9ff7244.7e88c",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "fixed",
        "sql": "SELECT `id`,`name`,`min_stock`,`stock_stb`,`stock_str`,`stock_stp`,`stock_stm` FROM `items` WHERE `min_stock`>=`stock_stp` AND `stock_stp`>=0;",
        "name": "INVENTORY",
        "x": 905,
        "y": 1000,
        "wires": [
            [
                "762091d8.42c72"
            ]
        ]
    },
    {
        "id": "f12e6bf2.98eec8",
        "type": "sqlite",
        "z": "a9ff7244.7e88c",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "fixed",
        "sql": "SELECT * FROM `low_stock` WHERE `location` LIKE '%STP%';",
        "name": "INVENTORY",
        "x": 645,
        "y": 1180,
        "wires": [
            [
                "ca78d906.b51528",
                "7f77d44d.0eac0c"
            ]
        ]
    },
    {
        "id": "9963bb56.1cb258",
        "type": "comment",
        "z": "a9ff7244.7e88c",
        "name": "COMPROVEM MINSTOCK VS ACTUAL_STOCK",
        "info": "",
        "x": 445,
        "y": 880,
        "wires": []
    },
    {
        "id": "b42affb9.1a0b3",
        "type": "sqlite",
        "z": "a9ff7244.7e88c",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "msg.topic",
        "sql": "SELECT * FROM `low_stock` WHERE `ordered`=0;",
        "name": "INVENTORY",
        "x": 405,
        "y": 1100,
        "wires": [
            []
        ]
    },
    {
        "id": "7728c4b5.4c04dc",
        "type": "ui_table",
        "z": "a9ff7244.7e88c",
        "group": "eb462800.3d9528",
        "name": "ITEMTABLE NOORDERED",
        "order": 4,
        "width": "16",
        "height": "3",
        "columns": [
            {
                "field": "name",
                "title": "NAME",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "min_stock",
                "title": "MIN",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "stock_stp",
                "title": "NOW",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 745,
        "y": 1100,
        "wires": []
    },
    {
        "id": "3ad72bf4.700b94",
        "type": "delay",
        "z": "a9ff7244.7e88c",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 385,
        "y": 1180,
        "wires": [
            [
                "f12e6bf2.98eec8"
            ]
        ]
    },
    {
        "id": "376ee6f5.eaef9a",
        "type": "telegram receiver",
        "z": "a9ff7244.7e88c",
        "d": true,
        "name": "EVENT LISTENER",
        "bot": "35d1d63d.95944a",
        "saveDataDir": "",
        "filterCommands": false,
        "x": 1305,
        "y": 920,
        "wires": [
            [
                "6fc07cc5.83ada4"
            ],
            [
                "6fc07cc5.83ada4"
            ]
        ]
    },
    {
        "id": "6fc07cc5.83ada4",
        "type": "function",
        "z": "a9ff7244.7e88c",
        "d": true,
        "name": "",
        "func": "var possibles_respostes = [\"Y\",\"YES\",\"yes\",\"ye\",\"y\",\"s\",\"si\",\"sí\",\"N\",\"n\",\"NO\",\"no\"];\nif(!possibles_respostes.includes(msg.payload.content)) {\n   return [{payload:{\n       content: \"PLEASE TRY AGAIN. BAD INPUT\",\n       type: \"message\",\n       chatId: \"5019177108\"\n   }},null] \n} else {\n    if(possibles_respostes.slice(0,8).includes(msg.payload.content)) {\n        \n    } else if(possibles_respostes.slice(8).includes(msg.payload.content)) {\n        \n    } else {\n        return [{payload:{\n            content: \"PLEASE TRY AGAIN. UNKNOWN ERROR\",\n            type: \"message\",\n            chatId: \"5019177108\"\n        }},null] \n    }\n}\n\nreturn null;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1245,
        "y": 860,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "2d313eec.11dfe2",
        "type": "ui_text",
        "z": "a9ff7244.7e88c",
        "group": "eb462800.3d9528",
        "order": 5,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"NEED RESTOCK AND HAS BEEN ORDERED\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 1165,
        "y": 1040,
        "wires": []
    },
    {
        "id": "46e9ec08.ea34b4",
        "type": "ui_text",
        "z": "a9ff7244.7e88c",
        "group": "eb462800.3d9528",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"LIST OF ALL ITEMS\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 165,
        "y": 80,
        "wires": []
    },
    {
        "id": "1de59aed.5d1645",
        "type": "ui_text",
        "z": "a9ff7244.7e88c",
        "group": "eb462800.3d9528",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"NEED RESTOCK NO ORDERED\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 1165,
        "y": 1120,
        "wires": []
    },
    {
        "id": "b7fc83da.29b4f",
        "type": "ui_table",
        "z": "a9ff7244.7e88c",
        "group": "eb462800.3d9528",
        "name": "ITEMTABLE ORDERED",
        "order": 6,
        "width": "16",
        "height": "3",
        "columns": [
            {
                "field": "name",
                "title": "NAME",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "min_stock",
                "title": "MIN",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "stock_stp",
                "title": "NOW",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 965,
        "y": 1280,
        "wires": []
    },
    {
        "id": "a28bbc11.83544",
        "type": "ui_dropdown",
        "z": "a9ff7244.7e88c",
        "name": "",
        "label": "ITEM",
        "tooltip": "",
        "place": "Select option",
        "group": "ab942ba8.0ae498",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 365,
        "y": 1380,
        "wires": [
            [
                "e1bea5a7.d64b68"
            ]
        ]
    },
    {
        "id": "5a95bca0.6a7dc4",
        "type": "ui_button",
        "z": "a9ff7244.7e88c",
        "name": "",
        "group": "ab942ba8.0ae498",
        "order": 3,
        "width": "16",
        "height": "1",
        "passthru": false,
        "label": "EDIT ORDER STATUS",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": " ",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 465,
        "y": 1500,
        "wires": [
            [
                "fc3bbfb0.6e8e9",
                "8be3da96.63d568"
            ]
        ]
    },
    {
        "id": "75ca571c.328cb8",
        "type": "ui_text",
        "z": "a9ff7244.7e88c",
        "group": "5de87a9a.808364",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "ORDER STATUS",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"ORDER ITEM\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 1165,
        "y": 1080,
        "wires": []
    },
    {
        "id": "bdd99925.4ef088",
        "type": "function",
        "z": "a9ff7244.7e88c",
        "name": "",
        "func": "let array = [];\nfor(let i = 0; i < msg.payload.length; ++i) {\n    let id = msg.payload[i].id;\n    let name = msg.payload[i].name;\n    array.push(JSON.parse(`{\"${name}\":${id}}`));\n}\nmsg.options = array;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 385,
        "y": 1280,
        "wires": [
            [
                "a28bbc11.83544"
            ]
        ]
    },
    {
        "id": "192111a3.4c565e",
        "type": "sqlite",
        "z": "a9ff7244.7e88c",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "prepared",
        "sql": "-- UPDATE `items` SET `stock_actual`=((SELECT `stock_actual` FROM `items` WHERE `id`=$a)+$b) WHERE `id`=$a;\nUPDATE `low_stock` SET `ordered`=1 WHERE `id`=$a;",
        "name": "INVENTORY",
        "x": 745,
        "y": 1480,
        "wires": [
            [
                "a0f59dfa.dbf6e"
            ]
        ]
    },
    {
        "id": "3d2fd934.70d7b6",
        "type": "link out",
        "z": "a9ff7244.7e88c",
        "name": "ordered",
        "links": [
            "bc7560d7.53ee2",
            "76f84a6d.f5a524"
        ],
        "x": 1075,
        "y": 1480,
        "wires": []
    },
    {
        "id": "fc3bbfb0.6e8e9",
        "type": "function",
        "z": "a9ff7244.7e88c",
        "name": "",
        "func": "var a = flow.get(\"order_item\");\n\nmsg.params = {\n    $a: a\n}\n\n// quan hem acabat desactivem el botó CREATE\nflow.set(\"order_item\",undefined);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 725,
        "y": 1380,
        "wires": [
            [
                "192111a3.4c565e"
            ]
        ]
    },
    {
        "id": "8be3da96.63d568",
        "type": "function",
        "z": "a9ff7244.7e88c",
        "name": "SET",
        "func": "msg.payload = null;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 365,
        "y": 1440,
        "wires": [
            [
                "a28bbc11.83544"
            ]
        ],
        "icon": "node-red/swap.svg"
    },
    {
        "id": "42126e8.eecee9",
        "type": "inject",
        "z": "a9ff7244.7e88c",
        "name": "1s",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 165,
        "y": 1600,
        "wires": [
            [
                "36439f73.cc062"
            ]
        ]
    },
    {
        "id": "36439f73.cc062",
        "type": "function",
        "z": "a9ff7244.7e88c",
        "name": "",
        "func": "if(flow.get(\"order_item\") != undefined) {\n    msg.enabled = true;\n} else {\n    msg.enabled = false;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 385,
        "y": 1600,
        "wires": [
            [
                "5a95bca0.6a7dc4"
            ]
        ]
    },
    {
        "id": "e1bea5a7.d64b68",
        "type": "change",
        "z": "a9ff7244.7e88c",
        "name": "SET",
        "rules": [
            {
                "t": "set",
                "p": "order_item",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 525,
        "y": 1380,
        "wires": [
            []
        ]
    },
    {
        "id": "bc7560d7.53ee2",
        "type": "link in",
        "z": "a9ff7244.7e88c",
        "name": "",
        "links": [
            "3d2fd934.70d7b6",
            "76e1504d.e96b8",
            "792f9a1a.4ad0d4",
            "7f77d44d.0eac0c",
            "b42dce68.da7db",
            "d37fda0b.b354d8"
        ],
        "x": 155,
        "y": 1180,
        "wires": [
            [
                "2ca58c59.9d9a74",
                "3ad72bf4.700b94"
            ]
        ]
    },
    {
        "id": "a0f59dfa.dbf6e",
        "type": "delay",
        "z": "a9ff7244.7e88c",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 925,
        "y": 1480,
        "wires": [
            [
                "3d2fd934.70d7b6"
            ]
        ]
    },
    {
        "id": "612d636.1e3809c",
        "type": "sqlite",
        "z": "a9ff7244.7e88c",
        "mydb": "f017de5e.2fd5b",
        "sqlquery": "prepared",
        "sql": "-- UPDATE `items` SET `stock_actual`=((SELECT `stock_actual` FROM `items` WHERE `id`=$a)+$b) WHERE `id`=$a;\nUPDATE `low_stock` SET `stock_stp`=(`stock_stp`+$b) WHERE `item_id`=$a;",
        "name": "INVENTORY",
        "x": 865,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "a90cfe20.2ec04",
        "type": "link in",
        "z": "a9ff7244.7e88c",
        "name": "",
        "links": [
            "7f77d44d.0eac0c"
        ],
        "x": 135,
        "y": 1980,
        "wires": [
            [
                "316a4f09.98c76"
            ]
        ]
    },
    {
        "id": "918e807d.90716",
        "type": "comment",
        "z": "a9ff7244.7e88c",
        "name": "MIRAREM QUE NO PUGUEM TREURE ALGUN DELS VALORS DE LA LLISTA DE LOW_STOCK (aprofitant queries ja fetes)",
        "info": "",
        "x": 885,
        "y": 1900,
        "wires": []
    },
    {
        "id": "ca78d906.b51528",
        "type": "function",
        "z": "a9ff7244.7e88c",
        "name": "SET msg.payload",
        "func": "var array_order = [];\nvar array_noorder = [];\n\nfor(var i = 0; i < msg.payload.length; ++i) {\n    if(msg.payload[i].ordered === 0) {\n        array_noorder.push(msg.payload[i])\n    } else {\n        array_order.push(msg.payload[i])\n    }\n}\nreturn [{payload: array_noorder},{payload: array_order}];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 925,
        "y": 1180,
        "wires": [
            [
                "bdd99925.4ef088",
                "7728c4b5.4c04dc"
            ],
            [
                "b7fc83da.29b4f"
            ]
        ],
        "icon": "node-red/swap.svg"
    },
    {
        "id": "7f77d44d.0eac0c",
        "type": "link out",
        "z": "a9ff7244.7e88c",
        "name": "low_stock",
        "links": [
            "a90cfe20.2ec04",
            "bc7560d7.53ee2"
        ],
        "x": 635,
        "y": 1280,
        "wires": []
    },
    {
        "id": "316a4f09.98c76",
        "type": "function",
        "z": "a9ff7244.7e88c",
        "name": "",
        "func": "for(var i = 0; i < msg.payload.length; ++i) {\n    var attributes = Object.values(msg.payload[i]);\n    var boolean = true;\n    for (var j = 5; j < attributes.length - 1; ++j) {\n        if (attributes[4] >= attributes[j] && attributes[j] >= 0) {\n            boolean = false;\n            break;\n        }\n    }\n    if(boolean) {\n        msg.topic = `DELETE FROM low_stock WHERE id=${msg.payload[i].id}`;\n        node.send(msg);\n    }\n}\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 1980,
        "wires": [
            [
                "d2906d39.49128"
            ]
        ]
    },
    {
        "id": "d2906d39.49128",
        "type": "link out",
        "z": "a9ff7244.7e88c",
        "name": "low_stock delete if greater/equal",
        "links": [
            "150029ee.dff3f6"
        ],
        "x": 695,
        "y": 1980,
        "wires": []
    },
    {
        "id": "150029ee.dff3f6",
        "type": "link in",
        "z": "a9ff7244.7e88c",
        "name": "",
        "links": [
            "d2906d39.49128"
        ],
        "x": 155,
        "y": 1020,
        "wires": [
            [
                "b42affb9.1a0b3"
            ]
        ]
    },
    {
        "id": "7b132295.9b1bdc",
        "type": "ui_button",
        "z": "a9ff7244.7e88c",
        "name": "",
        "group": "c2c338f.8fbb4c8",
        "order": 1,
        "width": "8",
        "height": "1",
        "passthru": false,
        "label": "HOME",
        "tooltip": "",
        "color": "white",
        "bgcolor": "black",
        "className": "",
        "icon": "dashboard",
        "payload": "{\"tab\":\"0\"}",
        "payloadType": "json",
        "topic": "",
        "topicType": "str",
        "x": 390,
        "y": 340,
        "wires": [
            [
                "eb1c911b.3425c"
            ]
        ]
    },
    {
        "id": "7f6b9f32.2189b",
        "type": "ui_text",
        "z": "a9ff7244.7e88c",
        "group": "c2c338f.8fbb4c8",
        "order": 2,
        "width": "8",
        "height": "1",
        "name": "",
        "label": "",
        "format": "<strong><font color= #00CCCC><font size= 6 > {{\"POLSKA\"}} </font></strong>",
        "layout": "row-center",
        "className": "",
        "x": 170,
        "y": 40,
        "wires": []
    },
    {
        "id": "bbe6fe61a4cca181",
        "type": "rbe",
        "z": "a9ff7244.7e88c",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "options",
        "topi": "topic",
        "x": 190,
        "y": 660,
        "wires": [
            [
                "f0ff24ee.a3e8d8"
            ]
        ]
    }
]